___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "displayName": "Webtrekk Smartpixel - Tracking Configuration",
  "categories": ["ANALYTICS", "CONVERSIONS", "MARKETING"],
  "description": "Initialize Webtrekk tracking and configure tracking requests.",
  "securityGroups": [],
  "id": "cvt_temp_public_id",
  "type": "TAG",
  "version": 1,
  "brand": {
    "thumbnail": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGAAAABgCAYAAADimHc4AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4wwJCRwpT+ifuQAAAB1pVFh0Q29tbWVudAAAAAAAQ3JlYXRlZCB3aXRoIEdJTVBkLmUHAAAPuUlEQVR42u2daZBc1XmGn+/e28ssmhmNRiMiDBihQYAwCGTQgATIFjFIGEkQAZZDwGCo2JBQFScEKJxQrhROUin/cFIJAYJDICDisKVMAIGE9gXEIgUJsOQRCK0GNJt6lu577/ny495uTU93Twurpdn6VPWfvn2XPu/5lvc93zlXVFUpNxQFNaAG33dpOfg6W/c8zpXnPEyFU4+IjYiU/L5WueuDJgjGt+gxCZb++m5e+/CH7O5cx9b9/wnHoOMz9x3tFqBqEFF8YzjQ+Q6rt/81BzrfAxQQHLuSRdOf44Qx0xCxASlbQOk6X1F8DBabdz/Mf2+8ln2H3kQFVAQEXJNk3Y4HcF0fNYoxWgaglK2taye/2vwdVu34G0zURUy83y9c9nVs4tODLwCKiJZd0NG4GyQJ6uAbw/62tby47WZcP4mgqEpBS7Elxq0XraY6fiqWZZUt4HcabQK+F6E31cmqj+7l+S03k3QTCBaoUyRL6mZ9y88R8cou6HdJMkEx6tOe3MqL7y1m8/5foNKLJXEUH8Ud4FwQLH792Qvsb387sCS07IKOpBk1gAsmwuZ9D7Gh5Wck/U5UBUssFDMgcBaC4iB4KErMaeCmC1ZSFRuP2HbZAo5ghNGTbGPNjvt4q+UfEREqI+OodGqI29VFz7epoMKpIhqpJWLXowY+/O0vQ2qgZQsoHnhdPJMi6XZiSeDnjYCoy772TfzPlluww5GsmVghYBRHosyZ+k98tX4GaiIBW0awrRjxSE1JmLEz8gOvTcSO49hxJCRRqqC4fLD/2bydqCiWQHVsPCePvYDKyMQAHim94xgFQdgCbAQ7S3boSn7Bvs53sCwrBwQ1FkZ9Tmm8gmrnRAy9pSbAo8cC8o03VWVn61KSyc9QS+jvhR3xcKwxTD/5h2BbWFQc4ycaZc2jm7d+83M8yZ8B+cDkCQupjZ50zJ9lVFlAMNJ9PvliOV3JvUFQNkFOb4kEhAxQy+b0ExaEUNhlAErJhBUwruHcr3wPFcESG1WPlJ/EhJwgRh0n1JyHYiPH+plGlxwdqJ9BP2tAs8QG0VAnClmvmnBsGkScMgDH10VxTGa+ykE4T0cf6fflGFCi9unuT/nXRx8FSwI21l9MUGXRtX/A9GnnlQE4FqN+xcqVPPTowxgho+mnR70ag3E9vv+9W1DV4+aGRpUFrFizGh8FEYwx2W5Hlcu/eTmnnHRy2QWVeOijQKK7i1Xr1wYjW/umpoKIYKlw/3334ThOOQiXNvEEg/Ls88/T2tqaX3xTpWnyZM6eevYgiSMjPPNPplweeexRgIzryRyXQAuaOXMmkUiknAUdCxNoafkNO3ftyp/jC3jJFIsWXoN9HF3P6OEBImzctIneVDL/caNMPWsq5x/H1HNUASAKv3r5JfBNVlxIf/ANd93xJ4PifkYFAB/v+oS1G9YF5CtPGz9uHJddeikWUgYgh5mWgHw9/cwSelMptAAAZ045g8aG8cc19RzSABhjMGoCpaDfJ02azBFoNkaVjkSCl5a+QtR2sDSbGwjgpVIsvv4GYtEog6VJDrksSI3hsSf+g20fbstMove3kMbGRu6/+56i19qzZzd79u4NinD7yAsSpp6NEyYwb948EPLea1QC0Nl5iB//5IH8WYuCb8GMaedz/933FNRsNBzhK1avojNxKMN2M8ctQT3DDdcuoq6mdtDcz5AEYOXqlUHnS54xKWDZQlV18YKqpJviiSefzDuuRSEej7Pg21cP+v8dcjFg+aoVATsd4DfVVVVFr/Pu5s28/8G2vKtbRGHCuPFMaWoqA9BXHvA8j9Ub1iOqBR/M+Ibqisr8rLaPC3r2+eeIxmN5j7vG49oFC6kbWz+o7mfIAGBZFqrKmjVr2LVr14CdYlkWVZUDW0Bvby9vbnoLU+AyFbE4t936fWQIzMYOjRhgFM/3+Puf/UPxEalKdXVVwZGPQMuuT9ixsyXsYMn5zZxLZ3PixIklXWgxJCwgne4V7JwByNfOXZ/wzubNRUmaAhWVlQXvYRSWLFlCV1dXLrsNs6F5V84t+kzDzgI6OzsH7PxYLEYsFss/6gTeensTrvoD6zqh368qEIRFhI6ODh5//HFs285NU1VxHIfm5uZB9/0lB2DR4hvY8tEH2JApcEr/SWOU+//8Hv70jjsLkC/lpaWvgtEjKoKNx+N5OYAA6zasp7OnCzuS+9cMysUXNjN50mkjD4BETzeJ7i4iImEdfTYAlZVVBYlTa3sbq9auCfSaI3ALFRX5i2V9VZa9sTxv5wM4YvHAj/9qSOXeJXsWz/cR2w6WMIS+VjXdn0J1dVXezjfAE0ueIpFIhMuJij9wRTyeW1Iexp+1G9YXPPf0009n2jnnFuQYA8WwYZKGBlmHqoRLPoOPiFBZWZXjXVSV7p5unn5mCbYItmVndJq+Qbdvs1WIx+J5O+7DDz7gox3bC3qxS2bNQgYoOekvWYwYHiAiVFdX5nSmorS0tLBv3/6sjhQRzjrzLCafOgnpvzJdIBbLT7Ae/Lu/RW2LQqF87reuxBYL0RHoglJdPYXF/NAC+h8XhbUb1tHV253JUjQE4qrf/xaJrkSWjh8cC1xQ/9x0/4ED/O+ypUTEyv5TJqgDOrFhArMubCZjmCMNgAFvIkJ1HgHNN8rTzzyTk8lEIhGmT59OZyKR109nBWEBFWXjW29iO06ODxcRfN/nRz/6M6LR6FCTvkoLgAzggvLl7m+/9w5btr6f3cEC4+rHMfm0yXR3decSMVXi8Yqs74wqy1a8kXFhfUFQgYaGBq6adxVDsZU2CzKa5WXSQdS2bSorKrKESaPKk08/hWVb2ecY5Zqr5xOPxUklk/S9ooTCXbyvyKZKsqeX15Yvywqk6XsblGlTv0Z93dhBCbLHDwDPLbixkW3bWGJl2UhnZycb39yYo/vHozFuv/U2erq7AJM9UyWgxicez86CXn7tVT774vMCVilcPXceMScy8iwgy9QJphMlT1oXiUSwrICgBXqN8vHuT9m1d09ORnLetGl89eSTaT/UAY4VbCPWJ2jbYhGLxjKuxvM9Hvq3R3MljnBWrMKOsHDBwoJVEcMagP7mXEhdjEaioQUcHslPPvkEyWQy5xpzZn8DC+jo6AgAtHIFtVgsljlv95497Nz1cY70LCKoMSxevJi6ujqG6jKgkrggVcXzCm/jEljA4Vu1t7fz1FNPZQSzvm32JUGNTiKRwBIrq5ZTgXhFBY5z+LytW7fS2t6et4Pj8Qquv+76wCqH6EqskgBgjMlL4dNuwnZsxApigCgse30ZiWRv5hxfAknixIkncs7Us1FLaOvoxBY73KftcKsZMwbbdoIyFeCXzz2HGMXWXO4xsXECZ0yeHCxBFRm5ABRr0Ui0jzBnePm1V7MEMzGKpXDnD35APNR5EocO5VU7q6qqghk0gd9+/jmvL3s9v3v0DXNmz6auto6h3EoShI0xGDST/mUFYSAaiYQWoCS9FG+/+26WSxIRxtbVccOi6zNWc6grkZdb1FZVY4fnPv/iC/S4qYKy1O233Z4bQ0ZiEE6lUpkYIHmIWTQSIXRArN2wgU/37M6qbhNVzj37a9SNqcmIcYlEV9571tbUYFkWyVSKV159JX8HK8yaOZOmyU2DVnB1XF2QhFs8Qn45KBJagOd5PPjTBzEWYEtWrn7JzFk41uHdabu6Enk7dkxNLQCtBw+yffv2vL5dLOG6RYuwZejXHh/1E2YUTIKFb9LvmIgEaajC9pYdbHz37UCR9A5nNwa4eu480psWigjd3d05XMOg1E8YjwKrN67j87aDWZaUZr/xSJSLL5iBoiMbgHQH+76P63uBn88zIqOxKNgWK9eszmGxADNmXEhTU1OmTCRwQYlcrqFK4/jxoMpDjzwSyM59jqcHwNlTpzJp0qSc5UgjNgb4vo8qGN/PC1LEiYAqy5e/kZOuWiLcedsfI33clzGGntAC+gJgVGkc18DWbdvY8n9bCEumDz+PbaHGcO8992JZ1pAoOzkuWZCE88CWZWV3SBhQI9EIre1trH9zQ841GhsauXD617OchTGGVD5iZ5SG+nG8vPTVwPo0N+g3TZrMZbMuGZLC2zGzgGK1QNFolMf+/Rd09XT3u7lw1ulTGN/QkF29rEoqmcrV9lVpGFvPmo3rM6O773lilLlXXIEjw2fhT0meNJlM4nleLnGSTFTl6f96JuQChwOmazwWzF8QZEl9Rqxr/EyFdFa6CsSqq9i8efPheeP0LBqQ8n3mzP5mwZLEUceE0520Z+9evmhvy9oiVUJStXD+/NzzjJJKpXIAjVdV8fqK5XQmDuW9X2N9PTMuuDB7NcxoSEOLuan3t75PbzKZQ2vnXzWf2pqa/qk+xvgkU6kcAc31XP75oX/JsqQM91Dl3r/4y+z54mHQnFJ0vuu6+L4/oIsSAj0/3aWObXPNwoUoms1WNZhXSPb25jBrVaWnpycbR1WwLWqrarj5uzeGe36OkhiQ9tvpfPvLpH1jqsdwxpQpeahzIG27nnukD4Gq0jxjRmbSfThtAlYSC0gD4XleURAUsBUuOm86X/m9iXkUT8H1fFKuW/Q6EEy6Y5Qr5lyO4wy/nReco7WANBDGmCOyABHBd13uuPPOgrm666bw3CPbp18Uqior+fbceQzHVhJnmVZD+5YVFmq+8WlqaqK5+aKC7sJNubhucReUhu6GRdfR2NA4LAE4OpvVoLwwqDYLcvZi7NO2beZdOZdowb33la6eLlzPHfBa6SMVsTi3/OEfgTB6LeBLYeYZvnHZ7KBksIBvb2trO6L0FuC0SZM49eRThlS953EHwPd88P0BJ77T/r4mVsH5507DDCAVt7a1F315mieBEDer+WJqamuH/MzXsXFBoSvwfK/oLhvpifubbr2JmtparEIl4ggHDx4sPnJUcCyLm268cViIbscMgHSnFe0wy8JxHO66667wlVGF1vkqra0Hi/t0VZqbmznrjDMZzu3oeACH99x0Ig4R28lltqFfF9vi6+edz4RxDQgy4CLrLw62Einy8ky1hO9+ZzHDvR313tHpoqwDn32GY9uZ96zkA6oiFqeutnZArd43ho6OdnqTqQEZmAiMrR8bVt3J6AXgywAlgfMZeGQf6QbaIc65cJcBKLehzAPKrQxAGYByKykPMKBW+DLMdHYzsnHV9OtPSpAAHFUQDl4HbqHqE+58F65oMSN72KoFahFUzluDZwEiihpI+W2s3v6TUI4u3ateh2qLOg3MarofWyNHbQLO0Y4EEYPn9/LhgedwfR+xR/joB8bETuKSKQ+Ug3A5C+pPTaXM6QYNAMUgMlq6TYaiBZRbGYAyAOU2iADIiM//Sx8BjpYHhHq8n34Lqfio2iMfCFO6f/j/ki0iwsdcYisAAAAASUVORK5CYII\u003d",
    "displayName": "Benutzerdefinierte Vorlage",
    "id": "brand_dummy"
  },
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "LABEL",
    "name": "tagExplanation",
    "displayName": "You can send data for a page or an event. \u003cbr\u003e Please note that Webtrekk needs an initial page request in every session."
  },
  {
    "type": "RADIO",
    "name": "requestType",
    "displayName": "Request Type",
    "radioItems": [
      {
        "value": "page",
        "displayValue": "Page"
      },
      {
        "value": "event",
        "displayValue": "Event"
      }
    ],
    "simpleValueType": true
  },
  {
    "help": "Enter your Webtrekk Track ID here. If you want to send the same information to several accounts, simply enter the corresponding Track IDs separated by a comma. You find it at \"Webtrekk Q3 \u003e  Configuration \u003e System Configuration \u003e Data Collection \u003e Your Track ID\"",
    "displayName": "Track ID",
    "simpleValueType": true,
    "name": "initTrackId",
    "type": "TEXT",
    "enablingConditions": [
      {
        "paramName": "requestType",
        "paramValue": "page",
        "type": "EQUALS"
      }
    ],
    "valueHint": "01234567891234 (String)"
  },
  {
    "help": "Enter the domain to which you want the data to be sent. If you are using a Webtrekk Track Domain, you should have received an email containing this Domain, among other information regarding the setup.",
    "displayName": "Track Domain",
    "simpleValueType": true,
    "name": "initTrackDomain",
    "type": "TEXT",
    "enablingConditions": [
      {
        "paramName": "requestType",
        "paramValue": "page",
        "type": "EQUALS"
      }
    ],
    "valueHint": "track.webtrekk.com (String)"
  },
  {
    "type": "TEXT",
    "name": "initDomain",
    "displayName": "Manual exclusion of referrers",
    "simpleValueType": true,
    "help": "By default, the domain that includes the Smart Pixel is not counted as a referrer in Webtrekk. Here you can override this setting. \u003cbr\u003e\nAdd all (sub)domains that should be excluded from referrer analyses (e.g. your own domain, payment providers etc.). \u003cbr\u003e\nEnter these (sub)domains as comma-separated list of domains and subdomains without http(s).You can use wildcards (*) to include subdomains.",
    "enablingConditions": [
      {
        "paramName": "requestType",
        "paramValue": "page",
        "type": "EQUALS"
      }
    ],
    "valueHint": "*.domain.com,payment.com (String)",
    "lineCount": 2,
    "valueValidators": [
      {
        "type": "REGEX",
        "args": [
          "^\\S*$"
        ],
        "errorMessage": "Please delete all whitespaces"
      }
    ]
  },
  {
    "help": "Please choose whether you want to set the cookie via the browser or via the server.\u003cbr /\u003eWe only recommend to use server-side cookies if your are using a custom track domain and if the track domain is the same as your web domain. This allows first party tracking and the highest data quality.",
    "macrosInSelect": false,
    "selectItems": [
      {
        "displayValue": "1: client-side cookies",
        "value": 1
      },
      {
        "displayValue": "3: server-side cookies",
        "value": 3
      }
    ],
    "displayName": "Set Cookie",
    "defaultValue": 1,
    "simpleValueType": true,
    "name": "cookie",
    "type": "SELECT",
    "enablingConditions": [
      {
        "paramName": "requestType",
        "paramValue": "page",
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "actionGroup",
    "displayName": "Event",
    "groupStyle": "ZIPPY_CLOSED",
    "subParams": [
      {
        "type": "TEXT",
        "name": "actionName",
        "displayName": "Event name",
        "simpleValueType": true,
        "help": "The name will be used in the \"Events\" analysis.",
        "valueHint": "en.homepage.search (String)"
      },
      {
        "type": "SIMPLE_TABLE",
        "name": "actionParameter",
        "displayName": "Event Parameter",
        "simpleTableColumns": [
          {
            "defaultValue": "",
            "displayName": "ID",
            "name": "id",
            "type": "TEXT",
            "valueHint": "Positive integer",
            "isUnique": true,
            "valueValidators": [
              {
                "type": "POSITIVE_NUMBER"
              }
            ]
          },
          {
            "defaultValue": "",
            "displayName": "Value",
            "name": "value",
            "type": "TEXT",
            "valueHint": "String"
          }
        ],
        "newRowButtonText": "Add event parameter",
        "help": "Event parameters can be used to log additional information about an event (e.g. Click area, Link type). \u003cbr\u003e\nEach parameter has to be configured in Webtrekk Q3 in order to be tracked. Please enter the ID as given in your configuration in the first column."
      }
    ],
    "enablingConditions": [
      {
        "paramName": "requestType",
        "paramValue": "event",
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "extensionActionGroup",
    "displayName": "Automatic tracking of HTML links",
    "groupStyle": "ZIPPY_CLOSED",
    "subParams": [
      {
        "type": "LABEL",
        "name": "extensionActionDescription",
        "displayName": "HTML links can be tracked automatically. \u003cbr\u003e\u003cbr\u003eHint: If links are added to the page after this tag is executed, you can mark them by adding another instance of the Webtrekk Smartpixel tag and the \u0027event\u0027 setting. You\u0027ll find a \u0027reload\u0027 checkbox here then. \u003cbr\u003e",
        "enablingConditions": [
          {
            "paramName": "requestType",
            "paramValue": "page",
            "type": "EQUALS"
          }
        ]
      },
      {
        "type": "CHECKBOX",
        "name": "extensionActionReload",
        "checkboxText": "Reload links",
        "simpleValueType": true,
        "help": "Activate this to parse your page for link elements again. Useful for lazyload mechanisms.",
        "enablingConditions": [
          {
            "paramName": "requestType",
            "paramValue": "event",
            "type": "EQUALS"
          }
        ]
      },
      {
        "type": "CHECKBOX",
        "name": "extensionActionActivate",
        "checkboxText": "Activate automatic tracking",
        "simpleValueType": true,
        "enablingConditions": [
          {
            "paramName": "requestType",
            "paramValue": "page",
            "type": "EQUALS"
          }
        ]
      },
      {
        "type": "RADIO",
        "name": "extensionActionType",
        "displayName": "Event tracking type",
        "radioItems": [
          {
            "value": "link",
            "displayValue": "Link (Automatic naming)",
            "help": ""
          },
          {
            "value": "standard",
            "displayValue": "Standard (Manual naming)"
          }
        ],
        "simpleValueType": true,
        "help": "\u003cb\u003eLink\u003c/b\u003e\u003cbr\u003e \n\u003cul\u003e\n\u003cli\u003eAll HTML-links are tracked. \u003c/li\u003e\n\u003cli\u003eUses the target URL of the link elements (href) as name, minus \"http(s)\" and possible URL parameters or anchors. \u003c/li\u003e\n\u003cli\u003eYou can add individual information and make the link name unique by using the value of the \"Link marking attribute\". It will be used as prefix, if it is available in the element.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cb\u003eStandard\u003c/b\u003e\n\u003cul\u003e\u003cli\u003eOnly links that have the selected \"Link marking attribute\" are tracked. \u003c/li\u003e\n\u003cli\u003e The value of the attribute is used as the event name. \u003c/li\u003e\n\u003c/ul\u003e",
        "enablingConditions": [
          {
            "paramName": "extensionActionActivate",
            "paramValue": true,
            "type": "EQUALS"
          }
        ]
      },
      {
        "type": "TEXT",
        "name": "extensionActionAttribute",
        "displayName": "Link marking attribute",
        "simpleValueType": true,
        "help": "Enter the attribute to be used to mark a link here. Default is \u0027data-name\u0027.",
        "enablingConditions": [
          {
            "paramName": "extensionActionActivate",
            "paramValue": true,
            "type": "EQUALS"
          }
        ],
        "valueHint": "data-name (String)"
      },
      {
        "type": "TEXT",
        "name": "extensionActionExtend",
        "displayName": "Include URL parameter in event name",
        "simpleValueType": true,
        "help": "With this option you can include URL parameters in the automatic generated link name.\u003cbr\u003e\nPlease specify all URL parameters that should be used for this.\n\u003cbr\u003e\u003cb\u003eExample:\u003c/b\u003e \u003cbr\u003e\nURL-Parameter: mc\u003cbr\u003e\nURL: www.demoshop.com/sale.html?mc\u003dteaser1\u003cbr\u003e\nEvent name: www.demoshop.com/sale.html?mc\u003dteaser1",
        "enablingConditions": [
          {
            "paramName": "extensionActionType",
            "paramValue": "link",
            "type": "EQUALS"
          }
        ],
        "valueHint": "URL parameter1,URL parameter2 (String)",
        "valueValidators": [
          {
            "type": "REGEX",
            "args": [
              "^\\S*$"
            ],
            "errorMessage": "Please delete all whitespaces"
          }
        ]
      },
      {
        "type": "CHECKBOX",
        "name": "extensionActionWithHash",
        "checkboxText": "Include hash in event name",
        "simpleValueType": true,
        "help": "With this option you can include hashes in the automatic generated link name.\u003cbr\u003e\n\u003cbr\u003e\u003cb\u003eExample:\u003c/b\u003e \u003cbr\u003e\nURL: www.demoshop.com/sale.html?#teaser1\u003cbr\u003e\nGenerated Event-Name: www.demoshop.com/sale.html#teaser1",
        "enablingConditions": [
          {
            "paramName": "extensionActionType",
            "paramValue": "link",
            "type": "EQUALS"
          }
        ]
      },
      {
        "type": "CHECKBOX",
        "name": "extensionActionDelay",
        "checkboxText": "Delay next page",
        "simpleValueType": true,
        "help": "To increase data quality, you can delay the navigation to the next page when the user clicks on a link. \u003cbr\u003eThis will ensure that events will not get lost. \u003cbr\u003e\nYou can specify the time delay and mark links the pixel has to exclude from link delays. \u003cbr\u003e\nPlease note that this option slows down the navigation through your website and opening of the next page will be delayed by the specified amount of time.",
        "enablingConditions": [
          {
            "paramName": "extensionActionActivate",
            "paramValue": true,
            "type": "EQUALS"
          }
        ]
      },
      {
        "type": "TEXT",
        "name": "extensionActionDelayDuration",
        "displayName": "Adjust delay duration",
        "simpleValueType": true,
        "help": "Specify the desired time of the delay of the click event here (in ms, 200ms if no value given).",
        "enablingConditions": [
          {
            "paramName": "extensionActionDelay",
            "paramValue": true,
            "type": "EQUALS"
          }
        ],
        "valueHint": "200 (positive integer)"
      },
      {
        "type": "TEXT",
        "name": "extensionActionNoDelayAttribute",
        "displayName": "No-delay attribute",
        "simpleValueType": true,
        "help": "Specify an attribute name to bypass the link delay. Whenever this attribute is set on a link element, no delay will take place.",
        "enablingConditions": [
          {
            "paramName": "extensionActionDelay",
            "paramValue": true,
            "type": "EQUALS"
          }
        ],
        "valueHint": "String"
      },
      {
        "type": "SIMPLE_TABLE",
        "name": "extensionActionParameter",
        "displayName": "Event parameter",
        "simpleTableColumns": [
          {
            "defaultValue": "",
            "displayName": "ID",
            "name": "id",
            "type": "TEXT",
            "valueHint": "positive integer",
            "isUnique": true,
            "valueValidators": [
              {
                "type": "POSITIVE_NUMBER"
              }
            ]
          },
          {
            "defaultValue": "",
            "displayName": "Name of attribute",
            "name": "value",
            "type": "TEXT",
            "valueHint": "String"
          }
        ],
        "newRowButtonText": "Add event parameter",
        "help": "You can enrich the clickevent trackrequests with additional data, sent via an event parameter.\u003cbr\u003e  Please enter: the ID of the event parameter (configured in your analytics account) and the name of the attribute where the value is taken from. The attribute can be in the link element itself, or higher up in the DOM hierarchy.",
        "enablingConditions": [
          {
            "paramName": "extensionActionActivate",
            "paramValue": true,
            "type": "EQUALS"
          }
        ]
      }
    ]
  },
  {
    "help": "Page help text",
    "displayName": "Page",
    "name": "pageGroup",
    "groupStyle": "ZIPPY_CLOSED",
    "type": "GROUP",
    "subParams": [
      {
        "help": "By default, the pixel creates a name on the basis of the page URL. Parameters and hashes in the URL are not automatically taken into account for the page name. \u003cbr /\u003e Use this field to manually create a page name.",
        "displayName": "Page name",
        "simpleValueType": true,
        "name": "pageName",
        "type": "TEXT",
        "valueHint": "en.home (String)"
      },
      {
        "help": "With this option you can include hashes (#) in the automatic generated page name.\u003cbr\u003e \u003cbr\u003e\u003cb\u003eExample:\u003c/b\u003e \u003cbr\u003e URL: www.demoshop.com/newsletter.html?#register\u003cbr\u003e Page name: www.demoshop.com/newsletter.html#register",
        "enablingConditions": [
          {
            "paramName": "pageName",
            "type": "NOT_PRESENT",
            "paramValue": ""
          }
        ],
        "simpleValueType": true,
        "name": "advancedUseHashForDefaultPageName",
        "checkboxText": "Include hash in page name",
        "type": "CHECKBOX"
      },
      {
        "type": "TEXT",
        "name": "useParamsForDefaultPageName",
        "displayName": "Include URL parameter in page name",
        "simpleValueType": true,
        "help": "With this option you can include URL parameters in the automatic generated page name.\u003cbr\u003e\nPlease specify all URL parameters that should be used for this.\n\u003cbr\u003e\u003cb\u003eExample:\u003c/b\u003e \u003cbr\u003e\nURL-Parameter: mc\u003cbr\u003e\nURL: www.demoshop.com/sale.html?mc\u003dteaser1\u003cbr\u003e\nPage name: www.demoshop.com/sale.html?mc\u003dteaser1",
        "enablingConditions": [
          {
            "paramName": "pageName",
            "paramValue": "",
            "type": "NOT_PRESENT"
          }
        ],
        "valueHint": "parameter1,parameter2 (String)",
        "valueValidators": [
          {
            "type": "REGEX",
            "args": [
              "^\\S*$"
            ],
            "errorMessage": "Please delete all whitespaces"
          }
        ]
      },
      {
        "help": "\u003cstrong\u003eerrorMessages\u003c/strong\u003e\tError messages. (String)\u003cbr /\u003e \u003cstrong\u003epaywall\u003c/strong\u003e\tPaywall calls. (Boolean) \u003cbr /\u003e \u003cstrong\u003earticleTitle\u003c/strong\u003e\tTitle of the article. (String)\u003cbr /\u003e \u003cstrong\u003econtentTags\u003c/strong\u003e\tTags contained in the article. (String) \u003cbr /\u003e \u003cstrong\u003etitle\u003c/strong\u003e\tTitle of the page. (String) \u003cbr /\u003e \u003cstrong\u003etype\u003c/strong\u003e\tPage type. (String)\u003cbr /\u003e \u003cstrong\u003elength\u003c/strong\u003e\tLength of the page. (String)\u003cbr /\u003e \u003cstrong\u003edaysSincePublication\u003c/strong\u003e\tDays since the publication of the article. (Number)\u003cbr /\u003e \u003cstrong\u003etestVariant\u003c/strong\u003e\tName of the test variant. (String)\u003cbr /\u003e \u003cstrong\u003etestExperiment\u003c/strong\u003e\tName of the test. (String)\u003cbr /\u003e",
        "displayName": "Predefined page parameters",
        "name": "pagePredefined",
        "simpleTableColumns": [
          {
            "selectItems": [
              {
                "displayValue": "errorMessages",
                "value": "errorMessages"
              },
              {
                "displayValue": "paywall",
                "value": "paywall"
              },
              {
                "displayValue": "articleTitle",
                "value": "articleTitle"
              },
              {
                "displayValue": "contentTags",
                "value": "contentTags"
              },
              {
                "displayValue": "title",
                "value": "title"
              },
              {
                "displayValue": "type",
                "value": "type"
              },
              {
                "displayValue": "length",
                "value": "length"
              },
              {
                "displayValue": "daysSincePublication",
                "value": "daysSincePublication"
              },
              {
                "displayValue": "testVariant",
                "value": "testVariant"
              },
              {
                "displayValue": "testExperiment",
                "value": "testExperiment"
              }
            ],
            "defaultValue": "",
            "displayName": "Key",
            "name": "id",
            "isUnique": true,
            "type": "SELECT"
          },
          {
            "valueValidators": [
              {
                "type": "NON_EMPTY"
              }
            ],
            "defaultValue": "",
            "displayName": "Value",
            "name": "value",
            "type": "TEXT"
          }
        ],
        "type": "SIMPLE_TABLE",
        "newRowButtonText": "Add predefined page parameter"
      },
      {
        "help": "Page parameters must be configured in the Webtrekk tool before being able to track them via the pixel (Configuration \u003e Custom Parameters \u003e Page Parameters). The ID and data type (text/number) are defined for each parameter during account setup, among other things.\nThe ID to be entered here must be the one given in the account configuration.",
        "displayName": "Page parameter",
        "name": "pageParameter",
        "simpleTableColumns": [
          {
            "valueValidators": [
              {
                "errorMessage": "Please enter a number as parameter id.",
                "type": "POSITIVE_NUMBER"
              }
            ],
            "defaultValue": "",
            "displayName": "ID",
            "name": "id",
            "isUnique": true,
            "type": "TEXT",
            "valueHint": "positive integer"
          },
          {
            "defaultValue": "",
            "displayName": "Value",
            "name": "value",
            "type": "TEXT",
            "valueHint": "String"
          }
        ],
        "type": "SIMPLE_TABLE",
        "newRowButtonText": "Add page parameter"
      },
      {
        "help": "Page related categories are called content groups. They must be configured in the Webtrekk tool before being able to track them. \u003cbr\u003e Content group parameters should not exceed a length of 255 characters. \u003cbr\u003e\u003cbr\u003e\nThe ID to be entered here must be the one given in the configuration.",
        "displayName": "Content group",
        "name": "pageCategory",
        "simpleTableColumns": [
          {
            "valueValidators": [
              {
                "type": "POSITIVE_NUMBER"
              }
            ],
            "defaultValue": "",
            "displayName": "ID",
            "name": "id",
            "isUnique": true,
            "type": "TEXT",
            "valueHint": "positive integer"
          },
          {
            "defaultValue": "",
            "displayName": "Value",
            "name": "value",
            "type": "TEXT",
            "valueHint": "String"
          }
        ],
        "type": "SIMPLE_TABLE",
        "newRowButtonText": "Add content group"
      }
    ],
    "enablingConditions": [
      {
        "paramName": "requestType",
        "paramValue": "page",
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "eCommerce",
    "displayName": "E-Commerce",
    "groupStyle": "ZIPPY_CLOSED",
    "subParams": [
      {
        "type": "GROUP",
        "name": "productGroup",
        "displayName": "Products",
        "groupStyle": "ZIPPY_CLOSED",
        "subParams": [
          {
            "type": "TEXT",
            "name": "products",
            "displayName": "Product data",
            "simpleValueType": true,
            "help": "Expects an array with product information. Each entry is an object that contains the following properties: \u003cbr /\u003e\n\u003cstrong\u003eid\u003c/strong\u003e: String, mandatory, product ID. \u003cbr /\u003e\n\u003cstrong\u003estatus\u003c/strong\u003e: String, optional, defaults to \"view\" (product is viewed). Other options: \"basket\" , \"list\"  and \"confirmation\" \u003cbr /\u003e\n\u003cstrong\u003ecost\u003c/strong\u003e: Number, optional, contains the product price (\"0\" prices are allowed). If you transfer a product more than once (quantity property greater than 1), use the total price instead of the unit price. \u003cbr /\u003e\n\u003cstrong\u003equantity\u003c/strong\u003e: Number, optional, amount of product items. \u003cbr /\u003e\n\u003cstrong\u003esoldOut\u003c/strong\u003e: Boolean, optional, tracks if the product is sold out. \u003cbr /\u003e\n\u003cstrong\u003evariant\u003c/strong\u003e: String, optional, product variant. \u003cbr /\u003e\n\u003cstrong\u003eparameter\u003c/strong\u003e: Object, optional, e-commerce parameters, where the key equals the ID of the parameter.\u003cbr /\u003e\n\u003cstrong\u003ecategory\u003c/strong\u003e: Object, optional, product category, where the key equals the ID of the parameter given in your account configuration.\u003cbr /\u003e\u003cbr /\u003e\n\u003cstrong\u003eExample:\u003c/strong\u003e \u003cbr /\u003e\n[{\u003cbr /\u003e\n   \u0026nbsp\u0026nbsp\u0026nbsp\u0026nbsp id: \u0027ABC-123\u0027,\u003cbr /\u003e\n   \u0026nbsp\u0026nbsp\u0026nbsp\u0026nbsp status: \u0027basket\u0027, \u003cbr /\u003e\n  \u0026nbsp\u0026nbsp\u0026nbsp\u0026nbsp  cost: 99.90,\u003cbr /\u003e\n \u0026nbsp\u0026nbsp\u0026nbsp\u0026nbsp   quantity: 2,\u003cbr /\u003e\n  \u0026nbsp\u0026nbsp\u0026nbsp\u0026nbsp  soldOut: false,\u003cbr /\u003e\n \u0026nbsp\u0026nbsp\u0026nbsp\u0026nbsp   variant: \u0027green\u0027,\u003cbr /\u003e\n\u0026nbsp\u0026nbsp\u0026nbsp\u0026nbsp    parameter: {\u003cbr /\u003e\n    \u0026nbsp\u0026nbsp\u0026nbsp\u0026nbsp\u0026nbsp\u0026nbsp\u0026nbsp\u0026nbsp    1: \u0027L\u0027\u003cbr /\u003e\n \u0026nbsp\u0026nbsp\u0026nbsp\u0026nbsp   },\u003cbr /\u003e\n\u0026nbsp\u0026nbsp\u0026nbsp\u0026nbsp    category: {\u003cbr /\u003e\n\u0026nbsp\u0026nbsp\u0026nbsp\u0026nbsp\u0026nbsp\u0026nbsp\u0026nbsp\u0026nbsp        1: \u0027tops\u0027,\u003cbr /\u003e\n  \u0026nbsp\u0026nbsp\u0026nbsp\u0026nbsp\u0026nbsp\u0026nbsp\u0026nbsp\u0026nbsp      2: \u0027noname\u0027\u003cbr /\u003e\n \u0026nbsp\u0026nbsp\u0026nbsp\u0026nbsp   }\u003cbr /\u003e\n}]\u003cbr /\u003e",
            "valueHint": "Object array"
          }
        ]
      },
      {
        "type": "GROUP",
        "name": "orderGroup",
        "displayName": "Order",
        "groupStyle": "ZIPPY_CLOSED",
        "subParams": [
          {
            "type": "TEXT",
            "name": "orderId",
            "displayName": "Order ID",
            "simpleValueType": true,
            "help": "The order ID property contains a unique number identifying the order. Use of this setting ensures that no orders are counted twice. If no order ID is given, Webtrekk will create one automatically.",
            "valueHint": "M-12345 (String)"
          },
          {
            "type": "TEXT",
            "name": "orderValue",
            "displayName": "Order value",
            "simpleValueType": true,
            "help": "The orderValue property tracks the total order value and is mandatory for order tracking.",
            "valueHint": "120.99 (Positive float / integer)"
          },
          {
            "type": "TEXT",
            "name": "orderCurrency",
            "displayName": "Currency",
            "simpleValueType": true,
            "help": "Please enter the currency that was used for the order here. This is necessary in case you can choose between different currencies on your website and want to track order values in Webtrekk.",
            "valueHint": "EUR (ISO 4217)"
          },
          {
            "type": "TEXT",
            "name": "orderCouponValue",
            "displayName": "Coupon value",
            "simpleValueType": true,
            "help": "If you offer coupons, you can track the coupon value here.",
            "valueHint": "10.15 (Positive float / integer)"
          },
          {
            "type": "SIMPLE_TABLE",
            "name": "orderPredefined",
            "displayName": "Predefined e-commerce parameter",
            "simpleTableColumns": [
              {
                "defaultValue": "",
                "displayName": "Key",
                "name": "id",
                "type": "SELECT",
                "selectItems": [
                  {
                    "value": "paymentMethod",
                    "displayValue": "paymentMethod"
                  },
                  {
                    "value": "shippingService",
                    "displayValue": "shippingService"
                  },
                  {
                    "value": "shippingSpeed",
                    "displayValue": "shippingSpeed"
                  },
                  {
                    "value": "shippingCosts",
                    "displayValue": "shippingCosts"
                  },
                  {
                    "value": "grossMargin",
                    "displayValue": "grossMargin"
                  },
                  {
                    "value": "orderStatus",
                    "displayValue": "orderStatus"
                  }
                ]
              },
              {
                "defaultValue": "",
                "displayName": "Value",
                "name": "value",
                "type": "TEXT",
                "valueHint": "String"
              }
            ],
            "help": "\u003cstrong\u003ePayment method: \u003c/strong\u003eUse this to transmit the payment method of the order. (String)\u003cbr /\u003e\n\u003cstrong\u003eShipping service: \u003c/strong\u003eUse this to transmit the shipping service of the order. (String) \u003cbr /\u003e\n\u003cstrong\u003eShipping speed:\u003c/strong\u003e Use this to transmit the shipping speed of the order. (String)\u003cbr /\u003e \n\u003cstrong\u003eShipping costs:\u003c/strong\u003e Use this to transmit the shipping costs of the order. (Number) \u003cbr /\u003e\n\u003cstrong\u003eGross margin:\u003c/strong\u003e Use this to transmit the margin/mark-up of the order. (Number)\u003cbr /\u003e\n\u003cstrong\u003eOrder status: \u003c/strong\u003eUse this to transmit the order status of the order. (String)",
            "newRowButtonText": "Add predefined e-commerce parameter"
          },
          {
            "type": "SIMPLE_TABLE",
            "name": "orderParameter",
            "displayName": "E-Commerce parameter",
            "simpleTableColumns": [
              {
                "defaultValue": "",
                "displayName": "ID",
                "name": "id",
                "type": "TEXT",
                "valueHint": "Positive integer",
                "valueValidators": [
                  {
                    "type": "POSITIVE_NUMBER"
                  }
                ],
                "isUnique": true
              },
              {
                "defaultValue": "",
                "displayName": "Value",
                "name": "value",
                "type": "TEXT",
                "valueHint": "String"
              }
            ],
            "help": "Please enter any additional information you want to track in your order. You need to have an custom e-commerce parameter configured in your account to track additional information (please enter the ID of your e-commerce parameter).",
            "newRowButtonText": "Add e-commerce parameter"
          }
        ]
      }
    ],
    "enablingConditions": [
      {
        "paramName": "requestType",
        "paramValue": "page",
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "pageGoalsGroup",
    "displayName": "Website goals",
    "groupStyle": "ZIPPY_CLOSED",
    "subParams": [
      {
        "help": "Please add here the e-commerce parameters that are used to track a website goal (e.g., newsletter sign-up, login).\n\u003cbr\u003e\nYou have to configure an e-commerce parameter first to use it as a website goal. Please enter the ID of your e-commerce parameter.\u003cbr\u003e\nNote: As soon as a parameter is tracked (no matter which value is submitted), the goal is achieved. Therefore, it does not make sense to submit the value \"no\" for the goal \"Newsletter Registration\" if a user has not registered for the newsletter. Setting the value to \"no\" would also mark the goal as achieved.",
        "displayName": "Website goal (e-commerce parameter)",
        "name": "pageGoal",
        "simpleTableColumns": [
          {
            "valueValidators": [
              {
                "type": "POSITIVE_NUMBER"
              }
            ],
            "defaultValue": "",
            "displayName": "ID",
            "name": "id",
            "type": "TEXT",
            "valueHint": "Positive number",
            "isUnique": true
          },
          {
            "defaultValue": "",
            "displayName": "Value",
            "name": "value",
            "type": "TEXT",
            "valueHint": "String"
          }
        ],
        "type": "SIMPLE_TABLE",
        "newRowButtonText": "Add e-commerce parameter",
        "enablingConditions": [
          {
            "paramName": "requestType",
            "paramValue": "page",
            "type": "EQUALS"
          }
        ]
      },
      {
        "type": "SIMPLE_TABLE",
        "name": "actionGoal",
        "displayName": "Website Goal  (E-commerce parameter)",
        "simpleTableColumns": [
          {
            "defaultValue": "",
            "displayName": "ID",
            "name": "id",
            "type": "TEXT",
            "valueHint": "Positive number",
            "valueValidators": [
              {
                "type": "POSITIVE_NUMBER"
              }
            ],
            "isUnique": true
          },
          {
            "defaultValue": "",
            "displayName": "Value",
            "name": "value",
            "type": "TEXT",
            "valueHint": "String"
          }
        ],
        "enablingConditions": [
          {
            "paramName": "requestType",
            "paramValue": "event",
            "type": "EQUALS"
          }
        ],
        "newRowButtonText": "Add e-commerce parameter",
        "help": "Please add here e-commerce parameters that are used to track a website goal (e.g. newsletter sign-up, login).\n\u003cbr\u003e\nYou have to configure an e-commerce parameter that is used as a website goal. Please enter the ID of your e-commerce parameter).\u003cbr\u003e \u003cbr\u003e\nNote: As soon as a parameter is tracked (no matter which value is submitted), the goal is set as achieved. Therefor it does not make sense to submit the value \"no\" for the goal \"Newsletter Registration\" if a user has not registered for the newsletter. Setting the value to \"no\" would instead mark the goal as achieved."
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "campaignGroup",
    "displayName": "Campaign",
    "groupStyle": "ZIPPY_CLOSED",
    "subParams": [
      {
        "type": "TEXT",
        "name": "campaignId",
        "displayName": "Campaign ID (Mediacode)",
        "simpleValueType": true,
        "help": "Use this field if you want to send a campaign mediacode within the data layer. If you use this option, campaigns using URLs are not tracked.\u003cbr\u003e\n\u003cbr\u003eThe Campaign ID hast to be sent using URL encoding (e.g. \"%3D\" instead of \"\u003d\".\u003cbr\u003e\n\u003cbr\u003eCampaigns are only tracked if they have been configured in advance.\u003cbr\u003e",
        "valueHint": "wt_mc%3Dcampaign.a (String)"
      },
      {
        "type": "CHECKBOX",
        "name": "campaignOncePerSession",
        "checkboxText": "Track once per visit",
        "simpleValueType": true,
        "help": "Please check if you want to track each individual campaign just once within a visit."
      },
      {
        "type": "SIMPLE_TABLE",
        "name": "campaignParameter",
        "simpleTableColumns": [
          {
            "defaultValue": "",
            "displayName": "ID",
            "name": "id",
            "type": "TEXT",
            "valueHint": "positive integer",
            "isUnique": true,
            "valueValidators": [
              {
                "type": "POSITIVE_NUMBER"
              }
            ]
          },
          {
            "defaultValue": "",
            "displayName": "Value",
            "name": "value",
            "type": "TEXT",
            "valueHint": "String"
          }
        ],
        "help": "Please enter any campaign parameter you want to track here. You need to have a custom campaign parameter configured in your account for this.",
        "displayName": "Campaign parameter",
        "newRowButtonText": "Add campaign parameter"
      }
    ]
  },
  {
    "displayName": "Session",
    "name": "session",
    "groupStyle": "ZIPPY_CLOSED",
    "type": "GROUP",
    "subParams": [
      {
        "type": "TEXT",
        "name": "sessionLoginStatus",
        "displayName": "Login status",
        "simpleValueType": true,
        "help": "Pass the current login status of a user here. You need to have a predefined session parameter configured for this. \u003cbr\u003e\nPlease note: If you send more than one status, only the last value will be tracked.",
        "valueHint": "login (String)"
      },
      {
        "type": "SIMPLE_TABLE",
        "name": "sessionParameter",
        "displayName": "Session parameter",
        "simpleTableColumns": [
          {
            "defaultValue": "",
            "displayName": "ID",
            "name": "id",
            "type": "TEXT",
            "valueHint": "Positive integer",
            "isUnique": true,
            "valueValidators": [
              {
                "type": "POSITIVE_NUMBER"
              }
            ]
          },
          {
            "defaultValue": "",
            "displayName": "Value",
            "name": "value",
            "type": "TEXT",
            "valueHint": "String"
          }
        ],
        "help": "Session parameters always refer to one complete session (visit). \u003cbr\u003eIf the value for the parameter is transmitted during a visit several times, only the first or last value is evaluated, based on the configuration in your Webtrekk account. \u003cbr\u003e\u003cbr\u003ePlease indicate the ID of the parameter as configured in your Webtrekk account in the first column.",
        "newRowButtonText": "Add session parameter"
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "customerGroup",
    "displayName": "User",
    "groupStyle": "ZIPPY_CLOSED",
    "subParams": [
      {
        "type": "TEXT",
        "name": "customerId",
        "displayName": "User ID",
        "simpleValueType": true,
        "help": "Please indicate the user ID here. \u003cbr\u003eThis identifier can be used to identify a user across different web browsers and devices. \u003cbr\u003e\nUsually you should use an email adress for this. \u003cbr\u003e \u003cbr\u003eThe user id will be hashed automatically by the pixel.",
        "valueHint": "test@demoshop.com (String)"
      },
      {
        "type": "CHECKBOX",
        "name": "overwriteCustomerValidation",
        "checkboxText": "Safe predefined URM categories without validation",
        "simpleValueType": true,
        "help": "Activate this checkbox to automatically override the customer data saved in the Webtrekk Database when sending predefined parameters. If you leave it unchecked, make sure to map \u0027true\u0027 to the respective validation field.",
        "defaultValue": true
      },
      {
        "type": "TEXT",
        "name": "customerValidation",
        "displayName": "Customer validation",
        "simpleValueType": true,
        "enablingConditions": [
          {
            "paramName": "overwriteCustomerValidation",
            "paramValue": true,
            "type": "NOT_EQUALS"
          }
        ],
        "help": "Map a variable that returns a boolean \u0027true\u0027 to make sure that the predefined customer parameters can be overridden in the database.",
        "valueHint": "true (Boolean)"
      },
      {
        "type": "SIMPLE_TABLE",
        "name": "customerPredefined",
        "displayName": "Predefined URM category",
        "simpleTableColumns": [
          {
            "defaultValue": "",
            "displayName": "URM key",
            "name": "id",
            "type": "SELECT",
            "selectItems": [
              {
                "value": "email",
                "displayValue": "email"
              },
              {
                "value": "emailRID",
                "displayValue": "emailRID"
              },
              {
                "value": "firstName",
                "displayValue": "firstName"
              },
              {
                "value": "lastName",
                "displayValue": "lastName"
              },
              {
                "value": "telephone",
                "displayValue": "telephone"
              },
              {
                "value": "gender",
                "displayValue": "gender"
              },
              {
                "value": "birthday",
                "displayValue": "birthday"
              },
              {
                "value": "country",
                "displayValue": "country"
              },
              {
                "value": "city",
                "displayValue": "city"
              },
              {
                "value": "street",
                "displayValue": "street"
              },
              {
                "value": "streetNumber",
                "displayValue": "streetNumber"
              }
            ],
            "isUnique": true
          },
          {
            "defaultValue": "",
            "displayName": "URM value",
            "name": "value",
            "type": "TEXT",
            "valueHint": "String"
          }
        ],
        "help": "\u003cstrong\u003eemail:\u003c/strong\u003e Use this to transmit the e-mail address of a user. Will not be hashed by the pixel. (String)\u003cbr\u003e \u003cstrong\u003eemailRID:\u003c/strong\u003e Use this to transmit the e-mail receiver ID of the user. (String)\u003cbr\u003e \u003cstrong\u003eemailOptin:\u003c/strong\u003e Use this to transmit the e-mail optin status of the user. (Boolean)\u003cbr\u003e \u003cstrong\u003efirstName:\u003c/strong\u003e Use this to transmit the first name of the user. (String)\u003cbr\u003e \u003cstrong\u003elastName:\u003c/strong\u003e Use this to transmit the last name of the user. (String)\u003cbr\u003e \u003cstrong\u003etelephone:\u003c/strong\u003e Use this to transmit the telephone number of the user. (String)\u003cbr\u003e \u003cstrong\u003egender:\u003c/strong\u003e Use this to transmit the gender of the user (1 \u003d male | 2 \u003d female). (Number)\u003cbr\u003e \u003cstrong\u003ebirthday:\u003c/strong\u003e Use this to transmit the user\u0027s date of birth (YYYYMMDD). (String)\u003cbr\u003e \u003cstrong\u003ecountry:\u003c/strong\u003e Use this to transmit the country of the user. (String)\u003cbr\u003e \u003cstrong\u003ecity:\u003c/strong\u003e Use this to transmit the city of the user. (String)\u003cbr\u003e \u003cstrong\u003estreet:\u003c/strong\u003e Use this to transmit the street of the user. (String)\u003cbr\u003e \u003cstrong\u003estreetNumber:\u003c/strong\u003e Use this to transmit the street number of the user. (String)\u003cbr\u003e\u003cbr\u003e\nYou have to configured this Categories in Webtrekk.",
        "newRowButtonText": "Add predefined URM category"
      },
      {
        "type": "SIMPLE_TABLE",
        "name": "customerCategory",
        "displayName": "URM category",
        "simpleTableColumns": [
          {
            "defaultValue": "",
            "displayName": "URM category ID",
            "name": "id",
            "type": "TEXT",
            "valueHint": "Positive integer",
            "valueValidators": [
              {
                "type": "POSITIVE_NUMBER"
              }
            ]
          },
          {
            "defaultValue": "",
            "displayName": "URM category value",
            "name": "value",
            "type": "TEXT",
            "valueHint": "String"
          }
        ],
        "help": "Please enter your URM categories as configured in your account. The category ID is the ID given in your account configuration.",
        "newRowButtonText": "Add URM category"
      }
    ],
    "help": "Please enter the user ID here. This ID can be used to identify a user across different web browsers and devices. \u003cbr\u003e\nUsually you should use an email address for this. \u003cbr\u003e \u003cbr\u003eThe user ID will be hashed automatically by the pixel if it is an email address."
  },
  {
    "type": "GROUP",
    "name": "searchGroup",
    "displayName": "Internal search",
    "groupStyle": "ZIPPY_CLOSED",
    "subParams": [
      {
        "type": "TEXT",
        "name": "pageSearch",
        "displayName": "Search term",
        "simpleValueType": true,
        "help": "Add the search term, if you are using the POST method.\u003cbr\u003e\u003cbr\u003e\nThe internal search of a website can be realized by using the GET or POST method.\u003cbr\u003e\n\n\u003cb\u003eGet method\u003c/b\u003e\u003cbr\u003e\nSearch terms are submitted in a URL parameter. The applied parameter is stored in the system configuration.\u003cbr\u003e\u003cbr\u003e\n\n\u003cb\u003ePost method\u003c/b\u003e\u003cbr\u003e\nThe search term has to be submitted here.",
        "valueHint": "search term (String)"
      },
      {
        "type": "TEXT",
        "name": "pageNumberSearchResults",
        "displayName": "Number of search results",
        "simpleValueType": true,
        "help": "Please indicate if you want to track the number of search results per search term.\u003cbr\u003e\u003cbr\u003e\nYou have to configure a predefined event parameter to collect data.",
        "valueHint": "7 (Integer)"
      }
    ],
    "enablingConditions": [
      {
        "paramName": "requestType",
        "paramValue": "page",
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "formTrackingGroup",
    "displayName": "Form",
    "groupStyle": "ZIPPY_CLOSED",
    "subParams": [
      {
        "type": "CHECKBOX",
        "name": "extensionFormActivate",
        "checkboxText": "Activate form tracking",
        "simpleValueType": true,
        "enablingConditions": [
          {
            "paramName": "requestType",
            "paramValue": "page",
            "type": "EQUALS"
          }
        ],
        "help": "Forms can be tracked automatically. \u003cbr\u003eAll form fields are measured, with the exception of the \"hidden\", \"button\", \"image\", \"reset\" and \"submit\" field types."
      },
      {
        "type": "CHECKBOX",
        "name": "extensionFormAutomatic",
        "checkboxText": "Automatic form recognition",
        "simpleValueType": true,
        "help": "By enabling this option, the pixel will track all HTML form elements and will use the value of the attribute specified in \"Name of form\" to name it.",
        "defaultValue": true,
        "enablingConditions": [
          {
            "paramName": "extensionFormActivate",
            "paramValue": true,
            "type": "EQUALS"
          }
        ]
      },
      {
        "type": "LABEL",
        "name": "extensionFormManualTrackingHelp",
        "displayName": "When deactivating \u0027Automatic form recognition\u0027, please remember to add form elements to Webtrekk by executing \u0027wtSmart.extension.form.add(formElement)\u0027 in your code.",
        "enablingConditions": [
          {
            "paramName": "extensionFormAutomatic",
            "paramValue": false,
            "type": "EQUALS"
          }
        ]
      },
      {
        "type": "TEXT",
        "name": "extensionFormSelector",
        "displayName": "Manual selection of form fields",
        "simpleValueType": true,
        "help": "If you want to specify the forms that you want to track, you can use a CSS selector.\u003cbr\u003e\nPlease add the div here for this manual selection.",
        "enablingConditions": [
          {
            "paramName": "extensionFormAutomatic",
            "paramValue": true,
            "type": "EQUALS"
          }
        ],
        "valueHint": "div[data-my-custom-form] (String)"
      },
      {
        "type": "TEXT",
        "name": "extensionFormAttribute",
        "displayName": "Customize attribute for form name",
        "simpleValueType": true,
        "help": "By default, the \"data-name\" attribute is used to name the form. \u003cbr\u003ePlease indicate here if you want to use another attribute.",
        "enablingConditions": [
          {
            "paramName": "extensionFormActivate",
            "paramValue": true,
            "type": "EQUALS"
          }
        ],
        "valueHint": "data-name (String)"
      },
      {
        "type": "TEXT",
        "name": "extensionFormFieldAttribute",
        "displayName": "Customize attribute for form field name",
        "simpleValueType": true,
        "help": "By default, the \"data-name\" attribute is used to name the form fields. \u003cbr\u003e Please indicate here if you want to use another attribute (e.g. the \"id\" or \"name\" attribute).",
        "enablingConditions": [
          {
            "paramName": "extensionFormActivate",
            "paramValue": true,
            "type": "EQUALS"
          }
        ],
        "valueHint": "data-name (String)"
      },
      {
        "type": "CHECKBOX",
        "name": "extensionFormAnonymous",
        "checkboxText": "Anonymize form field data",
        "simpleValueType": true,
        "enablingConditions": [
          {
            "paramName": "extensionFormActivate",
            "paramValue": true,
            "type": "EQUALS"
          }
        ],
        "help": "Please check if you want to anonymise all submitted form data (e.g. if you also want to anonymize radio button content)."
      },
      {
        "type": "TEXT",
        "name": "extensionFormFullContent",
        "displayName": "Plain text for specific form fields",
        "simpleValueType": true,
        "help": "With the form field types \"select-multiple\", \"select-one\", \"checkbox\" and \"radio\", the precise values can be transmitted. \u003cbr\u003eWith all other form field types, only the field status is sent to Webtrekk, i.e. only \"filled_out\" is sent for a completed form field and not the content. \u003cbr\u003eHowever, if you would like to evaluate the form field content as clear text, add the corresponding form fields to the configuration property \"fullContent\".\u003cbr\u003e\nPlease enter as comma-separated string.",
        "enablingConditions": [
          {
            "paramName": "extensionFormActivate",
            "paramValue": true,
            "type": "EQUALS"
          }
        ],
        "valueHint": "name,address,phone (string)",
        "valueValidators": [
          {
            "type": "REGEX",
            "args": [
              "^\\S*$"
            ],
            "errorMessage": "Please delete whitespaces"
          }
        ]
      },
      {
        "type": "TEXT",
        "name": "extensionFormFieldValue",
        "displayName": "Alternativ attribute for form field value",
        "simpleValueType": true,
        "help": "For form fields of the type \"radio,\" \"select-one,\" \"select-multiple\" and \"checkbox\", the value of the \"value\" attribute will be sent to Webtrekk by default. Optionally, an alternative value attribute could be used.\u003cbr\u003eIf the alternative attribute is set, the value of all of the above-mentioned field types in the alternative attribute will be sent to Webtrekk. This is helpful if you are for example sending an ID as the standard value because this would be hard to understand.",
        "enablingConditions": [
          {
            "paramName": "extensionFormActivate",
            "paramValue": true,
            "type": "EQUALS"
          }
        ],
        "valueHint": "value (String)"
      },
      {
        "type": "SIMPLE_TABLE",
        "name": "extensionFormFieldDefaults",
        "displayName": "Form field defaults",
        "simpleTableColumns": [
          {
            "defaultValue": "",
            "displayName": "Form field",
            "name": "id",
            "type": "TEXT",
            "valueHint": "firstname (String)"
          },
          {
            "defaultValue": "",
            "displayName": "Default value",
            "name": "value",
            "type": "TEXT",
            "valueHint": "First Name (String)"
          }
        ],
        "help": "If you would like to track forms that have been pre-filled with a default value, you must inform the Smart Pixel of which form fields are concerned. This is done with the property \"defaults\". This includes an object with a mapping between form field names and form field default values.",
        "enablingConditions": [
          {
            "paramName": "extensionFormActivate",
            "paramValue": true,
            "type": "EQUALS"
          }
        ],
        "newRowButtonText": "Add field with default value"
      },
      {
        "type": "CHECKBOX",
        "name": "extensionFormPathAnalysis",
        "checkboxText": "Follow field path",
        "simpleValueType": true,
        "help": "Please check if you want to see the order in which the user filled out the form fields. \u003cbr\u003e\nNote that this influences calculation of some form related metrics.",
        "enablingConditions": [
          {
            "paramName": "extensionFormActivate",
            "paramValue": true,
            "type": "EQUALS"
          }
        ]
      },
      {
        "type": "CHECKBOX",
        "name": "extensionFormUpdate",
        "checkboxText": "Update Forms",
        "simpleValueType": true,
        "help": "The forms contained in page content reloaded by Ajax (e.g. when showing layers) can also be marked for automatic form tracking. To do this, call the \"update\" method as soon as new content is reloaded.",
        "enablingConditions": [
          {
            "paramName": "requestType",
            "paramValue": "event",
            "type": "EQUALS"
          }
        ]
      }
    ]
  },
  {
    "displayName": "Advanced",
    "name": "advanced",
    "groupStyle": "ZIPPY_CLOSED",
    "type": "GROUP",
    "subParams": [
      {
        "displayName": "Request Queue Settings",
        "name": "requestQueueGroup",
        "groupStyle": "ZIPPY_CLOSED",
        "type": "GROUP",
        "subParams": [
          {
            "help": "Check this box if you want to save data in a queue in case the device is offline to ensure data quality.",
            "defaultValue": true,
            "simpleValueType": true,
            "name": "requestQueueActivated",
            "checkboxText": "RequestQueue",
            "type": "CHECKBOX"
          },
          {
            "help": "Please enter after how many seconds a failed request has to be resent.",
            "valueValidators": [
              {
                "type": "POSITIVE_NUMBER"
              }
            ],
            "displayName": "Request interval (sec.)",
            "defaultValue": 5,
            "simpleValueType": true,
            "name": "requestQueueResendInterval",
            "type": "TEXT"
          },
          {
            "help": "Please specify how long a request has to be saved in the queue (in sec.)",
            "valueValidators": [
              {
                "type": "POSITIVE_NUMBER"
              }
            ],
            "displayName": "Max. time in queue (sec.)",
            "defaultValue": 300,
            "simpleValueType": true,
            "name": "requestQueueTtl",
            "type": "TEXT"
          },
          {
            "help": "Please specify the maximum number of requests that can be saved in the queue.",
            "valueValidators": [
              {
                "type": "POSITIVE_NUMBER"
              }
            ],
            "displayName": "Max. number of requests",
            "defaultValue": 100,
            "simpleValueType": true,
            "name": "requestQueueSize",
            "type": "TEXT"
          }
        ]
      },
      {
        "displayName": "Cross Device Bridge",
        "name": "cdbGroup",
        "groupStyle": "ZIPPY_CLOSED",
        "type": "GROUP",
        "subParams": [
          {
            "help": "Activate/ deactivate the Cross Device Bridge.",
            "defaultValue": true,
            "simpleValueType": true,
            "name": "advancedExecCDB",
            "checkboxText": "activate Cross Device Bridge",
            "type": "CHECKBOX"
          },
          {
            "help": "Activate/ deactivate the image cache for the Cross Device Bridge. This way the CDB user id is saved with the image cache of the browser.",
            "simpleValueType": true,
            "name": "advancedUseCDBCache",
            "checkboxText": "CDB image cache",
            "type": "CHECKBOX"
          }
        ]
      },
      {
        "help": "Check this box if you want to add the \"secure\" flag to all clientside Webtrekk cookies. Please be aware that your entire website needs to be accessible via HTTPS if you want to use this feature.",
        "simpleValueType": true,
        "name": "advancedSecureCookie",
        "checkboxText": "Secure Cookie",
        "type": "CHECKBOX"
      },
      {
        "help": "Check this box if you want to obfuscate requests to make it harder for ad blockers to detect Webtrekk track requests.",
        "simpleValueType": true,
        "name": "advancedRequestObfuscation",
        "checkboxText": "Request Obfuscation",
        "type": "CHECKBOX"
      },
      {
        "help": "Check this box if you want to use the old Webtrekk Ever ID. Highly recommended if you used Webtrek pixel V3, V4 or V5 / TI before.",
        "simpleValueType": true,
        "name": "advancedForceOldEverId",
        "checkboxText": "Force Old EverID",
        "type": "CHECKBOX"
      },
      {
        "help": "Check this box if you want to send data tracked in a WebView of an app via the SDK. Please note that activating this feature can lead to a slightly increased security risk when exchanging data. This is because the pixel creates a data exchange to your Webtrekk SDK (which you use to track the app) and does not send the data directly to your Webtrekk account.",
        "simpleValueType": true,
        "name": "advancedSendViaSDK",
        "checkboxText": "Send Via SDK",
        "type": "CHECKBOX"
      },
      {
        "type": "TEXT",
        "name": "advancedOptOutName",
        "displayName": "Opt-out cookie name",
        "simpleValueType": true,
        "help": "By default, if the user has a cookie named \u0027webtrekkOptOut\u0027, no trackrequest will be triggered. You can change the name of the cookie here.",
        "valueHint": "WebtrekkOptOut (String)"
      }
    ],
    "enablingConditions": [
      {
        "paramName": "requestType",
        "paramValue": "page",
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "trackGroup",
    "displayName": "Send trackrequest",
    "groupStyle": "ZIPPY_CLOSED",
    "subParams": [
      {
        "type": "RADIO",
        "name": "track",
        "displayName": "Track method",
        "radioItems": [
          {
            "value": "track",
            "displayValue": "Send trackrequest"
          },
          {
            "value": "trackPage",
            "displayValue": "Send trackrequest, force pagerequest"
          },
          {
            "value": "trackAction",
            "displayValue": "Send trackrequest, force event request"
          },
          {
            "value": false,
            "displayValue": "Don\u0027t send trackrequest"
          }
        ],
        "simpleValueType": true,
        "defaultValue": "track",
        "enablingConditions": [],
        "help": "Pick the track method here:\u003cbr\u003e\u003cbr\u003e\n\u003cstrong\u003eSend track request:\u003c/strong\u003e Let the underlying Smartpixel decide which request you need to track the data you mapped (recommended).\u003cbr\u003e\u003cbr\u003e\n\u003cstrong\u003eForce page request:\u003c/strong\u003e Sends a page request and omits all data that cannot be put in a page request (e.g. event name).\u003cbr\u003e\u003cbr\u003e\n\u003cstrong\u003eForce event request:\u003c/strong\u003e Sends an event request and omits all data that cannot be put in an event request (e.g. page parameter).\u003cbr\u003e\u003cbr\u003e\n\u003cstrong\u003eNo track request:\u003c/strong\u003e Do not send a trackrequest at all. Useful if you only want to\u003cbr\u003e\n\u003cul\u003e\u003cli\u003e\nreload form and link elements\n\u003c/li\u003e\u003cli\u003e\njust configure Webtrekk\u003c/li\u003e\n\u003cli\u003ejust add data but do not want to track it yet, because you might wait for more data in another trigger\u003c/li\u003e\u003c/ul\u003e"
      },
      {
        "type": "CHECKBOX",
        "name": "keepData",
        "checkboxText": "keep data in Smartpixel after trackrequest",
        "simpleValueType": true,
        "defaultValue": false,
        "help": "Check this box, if you want to reuse the data for another request.\u003cbr\u003eBy default, after each trackrequest the Smartpixel in emptied. \u003cbr\u003eKeeping the data does not work if the page is reloaded between requests."
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "debugGroup",
    "displayName": "Debug Logging",
    "groupStyle": "ZIPPY_CLOSED",
    "subParams": [
      {
        "simpleValueType": true,
        "name": "debug",
        "checkboxText": "Activate logging",
        "type": "CHECKBOX",
        "displayName": "Log debug messages to console"
      }
    ]
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

// Require the necessary APIs
const logToConsole = require('logToConsole');
const callInWindow = require('callInWindow');
const makeTableMap = require('makeTableMap');

// Functions

// If the user chose to log debug output, initialize the logging method
const log = data.debug ? logToConsole : () => {
    // do nothing
};
log('data (type ' + data.requestType + '):', data);

/**
 * Checks if data is available, then delegates it to Smartpixel or hands config to inconsistencyFixer
 * @param {String} root e.g. 'campaign' or 'session'
 * @param {Array.<String>} propertyNames e.g. ['id', 'oncePerSession', 'parameter']
 * @param {Function} inconsistencyFixer takes config, supposed to add inconsistent properties and call pixel
 */
const dataHandler_ = (root, propertyNames, inconsistencyFixer) => {
    const gtmNames = propertyNames.map((propertyName) => root + propertyName[0].toUpperCase() + propertyName.slice(1));
    const shallRun = gtmNames.some((GTMName) => data[GTMName]);
    if (shallRun) {
        const customProperties = ['parameter', 'category', 'goal'];
        const config = {};
        gtmNames.forEach((GTMName, index)=>{
            const GTMData = data[GTMName];
            const currentProperty = propertyNames[index];
            if (typeof GTMData !== 'undefined') {
                if (customProperties.indexOf(currentProperty) !== -1) {
                    config[currentProperty] = makeTableMap(GTMData, 'id', 'value');
                }
                else if (currentProperty === 'predefined') {
                    GTMData.forEach(predefinedParameter => {
                        config[predefinedParameter.id] = predefinedParameter.value;
                    });
                }
                else {
                    config[currentProperty] = GTMData;
                }
            }
        });
        if (inconsistencyFixer) {
            inconsistencyFixer(config);
        }
        else {
            const method = 'wtSmart.' + root + '.data.add';
            log('Calling ' + method + ': ', config);
            callInWindow(method, config);
        }
    }
};
if (data.requestType === 'page') {
    // Init
    /**
     * Handles pixel inconsistencies of init method
     * @param {Object} config
     */
    const initHandler_ = (config) => {
        if (data.initDomain) {
            config.domain = data.initDomain.split(',');
        }
        config.cookie = data.cookie.toString();
        log('Calling wtSmart.init.add: ', config);
        callInWindow('wtSmart.init.add', config);
    };
    dataHandler_('init', ['trackId', 'trackDomain'], initHandler_);
    // Advanced
    const advancedKeys = [
        'execCDB',
        'useCDBCache',
        'sendViaSDK',
        'optOutName',
        'forceOldEverId',
        'secureCookie',
        'requestObfuscation',
        'useHashForDefaultPageName'
    ];

    /**
     * Handles pixel inconsistencies of advanced method
     * @param {Object} config
     */
    const advancedHandler_ = (config) => {
        config.requestQueue = {
            activated: data.requestQueueActivated,
            resendInterval: data.requestQueueResendInterval * 1000,
            ttl: data.requestQueueTtl * 1000,
            size: data.requestQueueSize
        };
        config.useParamsForDefaultPageName = data.useParamsForDefaultPageName ? data.useParamsForDefaultPageName.split(',') : [];
        const method = 'wtSmart.advanced.add';
        log('Calling ' + method + ': ', config);
        callInWindow(method, config);
    };
    dataHandler_('advanced', advancedKeys, advancedHandler_);
    // Page & Search
    dataHandler_('page', [
        'name',
        'parameter',
        'category',
        'goal',
        'useHashForDefaultPageName',
        'useParamsForDefaultPageName',
        'predefined',
        'search',
        'numberSearchResults'
    ]);
    // order
    const orderParameter_ = ['id', 'parameter', 'value', 'currency', 'couponValue', 'predefined'];
    dataHandler_('order', orderParameter_);

    // products
    if (data.products && data.products.length > 0) {
        data.products.forEach(product => {
            const status = product.status ? product.status : 'view';
            const method = 'wtSmart.product.' + status + '.data.add';
            log('Calling ' + method + ': ', [product]);
            callInWindow(method, [product]);
        });
    }
}
else if (data.requestType === 'event') {
    // action
    dataHandler_('action', ['name', 'parameter', 'goal']);
    // Extension event stuff
    // links reload
    if (data.extensionActionReload) {
        log('Executing wtSmart.extension.action.reload');
        callInWindow('wtSmart.extension.action.reload');
    }
    // form update
    if (data.extensionFormUpdate) {
        log('Executing wtSmart.extension.form.update');
        callInWindow('wtSmart.extension.form.update');
    }
}
// campaign
dataHandler_('campaign', ['id', 'oncePerSession', 'parameter']);
// session
dataHandler_('session', ['loginStatus', 'parameter']);
// customer
/**
 * Handles overwriting the validation
 * @param {Object} config
 */
const customerHandler_ = (config) => {
    if (data.overwriteCustomerValidation) {
        config.validation = true;
    }
    log('Calling wtSmart.customer.data.add: ', config);
    callInWindow('wtSmart.customer.data.add', config);
};
dataHandler_('customer', ['id', 'predefined', 'category', 'validation'], customerHandler_);
// extension.action
if (data.extensionActionActivate) {
    const extensionActionHandler_ = (config) => {
        config.extend = data.extensionActionExtend ? data.extensionActionExtend.split(',') : [];
        if (data.extensionActionDelay) {
            config.delayDuration = data.extensionActionDelayDuration ? data.extensionActionDelayDuration : 200;
        }
        log('Calling wtSmart.extension.action.config', config);
        callInWindow('wtSmart.extension.action.config', config);
        callInWindow('wtSmart.extension.action.activate');
        log('Automatic linktracking activated');
    };
    const actionExtensionParameter_ = ['type', 'attribute', 'parameter', 'withHash', 'delay', 'noDelayAttribute', 'ignore', 'replace'];
    dataHandler_('extensionAction', actionExtensionParameter_, extensionActionHandler_);
}

// extension.form
if (data.extensionFormActivate) {
    const extensionFormParameter_ = ['automatic', 'attribute', 'anonymous', 'pathAnalysis'];
    const extensionFormHandler_ = (config) => {
        if (data.extensionFormSelector) {
            config.automatic = data.extensionFormSelector;
        }
        config.fullContent = data.extensionFormFullContent ? data.extensionFormFullContent.split(',') : [];
        config.field = {};
        if (data.extensionFormFieldAttribute) {
            config.field.attribute = data.extensionFormFieldAttribute;
        }
        if (data.extensionFormFieldValue) {
            config.field.value = data.extensionFormFieldValue;
        }
        if (data.extensionFormFieldDefaults) {
            config.field.defaults = makeTableMap(data.extensionFormFieldDefaults, 'id', 'value');
        }
        log('Calling wtSmart.extension.form.config: ', config);
        callInWindow('wtSmart.extension.form.config', config);
    };
    dataHandler_('extensionForm', extensionFormParameter_, extensionFormHandler_);
}
// Track
if (data.track !== false) {
    const trackMethod = 'wtSmart.' + data.track;
    log('Calling ' + trackMethod);
    callInWindow(trackMethod, data.keepData);
}
data.gtmOnSuccess();


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "all"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_globals",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keys",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "wtSmart.init.add"
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "wtSmart.track"
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "wtSmart.page.parameter.add"
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "wtSmart.page.category.add"
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "wtSmart.page.goal.add"
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "wtSmart.page.data.add"
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "wtSmart.advanced.add"
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "wtSmart.order.data.add"
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "wtSmart.product.view.data.add"
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "wtSmart.product.basket.data.add"
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "wtSmart.product.confirmation.data.add"
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "wtSmart.product.list.data.add"
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "wtSmart.campaign.data.add"
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "wtSmart.session.data.add"
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "wtSmart.customer.data.add"
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "wtSmart.action.data.add"
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "wtSmart.extension.action.config"
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "wtSmart.extension.action.activate"
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "wtSmart.extension.action.reload"
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "wtSmart.extension.teaser_tracking.add"
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "wtSmart.extension.teaser_tracking.config"
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "wtSmart.extension.teaser_tracking.activate"
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "wtSmart.extension.teaser_tracking.update"
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "wtSmart.extension.form.config"
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "wtSmart.extension.form.update"
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "wtSmart.trackPage"
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "wtSmart.trackAction"
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios:
- name: init only
  code: |
    const mockData = {
        requestType: 'page',
        keepData: false,
        track: 'track',
        initTrackDomain: 'track.webtrekk.com',
        initTrackId: '111111111111111',
        initDomain: 'test.de,bla.com',
        cookie: '1'
    };

    runCode(mockData);
    if (debugTest) {
        debugLog(calls);
    }
    assertApi('gtmOnSuccess').wasCalled();
    assertThat(calls.length).isEqualTo(2);

    calls.forEach((call, index) => {
        switch (index) {
            case 0:
                is(call, 'method', 'wtSmart.init.add');
                is(call, 'config.trackDomain', 'track.webtrekk.com');
                is(call, 'config.cookie', '1');
                is(call, 'config.domain', ['test.de', 'bla.com']);
                break;
            case 1:
                is(call, 'method', 'wtSmart.track');
                is(call, 'config', false);
                break;
            default:
                break;
        }
    });
- name: advanced only
  code: |
    const mockData = {
        requestType: 'page',
        keepData: false,
        track: 'track',
        advancedExecCDB: true,
        advancedForceOldEverId: true,
        advancedOptOutName: 'customCookieName',
        advancedRequestObfuscation: false,
        advancedSecureCookie: true,
        advancedSendViaSDK: false,
        advancedUseCDBCache: false,
        advancedUseHashForDefaultPageName: true,
        requestQueueActivated: true,
        requestQueueResendInterval: '7',
        requestQueueSize: '99',
        requestQueueTtl: '299',
        useParamsForDefaultPageName: 'para1,para2'
    };

    runCode(mockData);
    if (debugTest) {
        debugLog(calls);
    }
    assertApi('gtmOnSuccess').wasCalled();
    assertThat(calls.length).isEqualTo(2);

    calls.forEach((call, index) => {
        switch (index) {
            case 0:
                is(call, 'method', 'wtSmart.advanced.add');
                is(call, 'config.execCDB', true);
                is(call, 'config.forceOldEverId', true);
                is(call, 'config.optOutName', 'customCookieName');
                is(call, 'config.requestObfuscation', false);
                is(call, 'config.secureCookie', true);
                is(call, 'config.sendViaSDK', false);
                is(call, 'config.useCDBCache', false);
                is(call, 'config.useHashForDefaultPageName', true);
                is(call, 'config.requestQueue.activated', true);
                is(call, 'config.requestQueue.resendInterval', 7000);
                is(call, 'config.requestQueue.size', '99');
                is(call, 'config.requestQueue.ttl', 299000);
                is(call, 'config.useParamsForDefaultPageName', ['para1', 'para2']);
                break;
            case 1:
                is(call, 'method', 'wtSmart.track');
                is(call, 'config', false);
                break;
            default:
                break;
        }
    });
- name: page only
  code: |
    const mockData = {
        requestType: 'page',
        keepData: false,
        track: 'track',
        pageName: 'pagename',
        pageCategory: [
            {
                id: 43,
                value: 'pagecategory 43'
            }
        ],
        pageGoal: [
            {
                id: 11,
                value: 'pagegoal 11'
            }
        ],
        pageParameter: [
            {
                id: 2,
                value: 'pageparameter 2'
            },
            {
                id: 3,
                value: 'pageparameter 3'
            }
        ],
        pageNumberSearchResults: '23',
        pageSearch: 'search term',
        pagePredefined: [
            {id: 'errorMessages', value: 'errorMessages value'},
            {id: 'paywall', value: 'paywall value'},
            {id: 'articleTitle', value: 'articleTitle value'},
            {id: 'contentTags', value: 'contentTags value'},
            {id: 'title', value: 'title value'},
            {id: 'type', value: 'type value'},
            {id: 'length', value: 'length value'},
            {id: 'daysSincePublication', value: 'daysSincePublication value'},
            {id: 'testVariant', value: 'testVariant value'},
            {id: 'testExperiment', value: 'testExperiment value'}
        ]

    };

    runCode(mockData);
    if (debugTest) {
        debugLog(calls);
    }
    assertApi('gtmOnSuccess').wasCalled();
    assertThat(calls.length).isEqualTo(2);

    calls.forEach((call, index) => {
        switch (index) {
            case 0:
                is(call, 'method', 'wtSmart.page.data.add');
                is(call, 'config.name', 'pagename');
                is(call, 'config.category.43', 'pagecategory 43');
                is(call, 'config.goal.11', 'pagegoal 11');
                is(call, 'config.parameter.2', 'pageparameter 2');
                is(call, 'config.parameter.3', 'pageparameter 3');
                is(call, 'config.numberSearchResults', '23');
                is(call, 'config.search', 'search term');
                is(call, 'config.errorMessages', 'errorMessages value');
                is(call, 'config.paywall', 'paywall value');
                is(call, 'config.articleTitle', 'articleTitle value');
                is(call, 'config.contentTags', 'contentTags value');
                is(call, 'config.title', 'title value');
                is(call, 'config.type', 'type value');
                is(call, 'config.length', 'length value');
                is(call, 'config.daysSincePublication', 'daysSincePublication value');
                is(call, 'config.testVariant', 'testVariant value');
                is(call, 'config.testExperiment', 'testExperiment value');
                break;
            case 1:
                is(call, 'method', 'wtSmart.track');
                is(call, 'config', false);
                break;
            default:
                break;
        }
    });
- name: session only
  code: |
    const mockData = {
        requestType: 'page',
        keepData: false,
        track: 'track',
        sessionLoginStatus: 'logged in',
        sessionParameter: [
            {
                id: 2,
                value: 'sessionparameter 2'
            },
            {
                id: 3,
                value: 'sessionparameter 3'
            }
        ]
    };

    runCode(mockData);
    if (debugTest) {
        debugLog(calls);
    }
    assertApi('gtmOnSuccess').wasCalled();
    assertThat(calls.length).isEqualTo(2);

    calls.forEach((call, index) => {
        switch (index) {
            case 0:
                is(call, 'method', 'wtSmart.session.data.add');
                is(call, 'config.loginStatus', 'logged in');
                is(call, 'config.parameter.2', 'sessionparameter 2');
                is(call, 'config.parameter.3', 'sessionparameter 3');
                break;
            case 1:
                is(call, 'method', 'wtSmart.track');
                is(call, 'config', false);
                break;
            default:
                break;
        }
    });
- name: customer only
  code: |
    const mockData = {
        requestType: 'page',
        keepData: false,
        track: 'track',
        customerId: 'abc@def.de',
        overwriteCustomerValidation: true,
        customerCategory: [
            {
                id: 43,
                value: 'customercategory 43'
            },
            {
                id: 44,
                value: 'customercategory 44'
            }
        ],
        customerPredefined: [
            {id: 'email', value: 'email value'},
            {id: 'emailRID', value: 'emailRID value'},
            {id: 'firstName', value: 'firstName value'},
            {id: 'lastName', value: 'lastName value'},
            {id: 'telephone', value: 'telephone value'},
            {id: 'gender', value: 'gender value'},
            {id: 'birthday', value: 'birthday value'},
            {id: 'country', value: 'country value'},
            {id: 'city', value: 'city value'},
            {id: 'street', value: 'street value'},
            {id: 'streetNumber', value: 'streetNumber value'}
        ]

    };

    runCode(mockData);
    if (debugTest) {
        debugLog(calls);
    }
    assertApi('gtmOnSuccess').wasCalled();
    assertThat(calls.length).isEqualTo(2);

    calls.forEach((call, index) => {
        switch (index) {
            case 0:
                is(call, 'method', 'wtSmart.customer.data.add');
                is(call, 'config.id', 'abc@def.de');
                is(call, 'config.validation', true);
                is(call, 'config.category.43', 'customercategory 43');
                is(call, 'config.category.44', 'customercategory 44');
                is(call, 'config.validation', true);
                is(call, 'config.email', 'email value');
                is(call, 'config.emailRID', 'emailRID value');
                is(call, 'config.firstName', 'firstName value');
                is(call, 'config.lastName', 'lastName value');
                is(call, 'config.telephone', 'telephone value');
                is(call, 'config.gender', 'gender value');
                is(call, 'config.birthday', 'birthday value');
                is(call, 'config.country', 'country value');
                is(call, 'config.city', 'city value');
                is(call, 'config.street', 'street value');
                is(call, 'config.streetNumber', 'streetNumber value');
                break;
            case 1:
                is(call, 'method', 'wtSmart.track');
                is(call, 'config', false);
                break;
            default:
                break;
        }
    });
- name: campaign only
  code: |
    const mockData = {
        requestType: 'page',
        keepData: false,
        track: 'track',
        campaignId: 'wt_mc%3Dtest.blah.foo.bar',
        campaignOncePerSession: true,
        campaignParameter: [
            {
                id: 43,
                value: 'campaignParameter 43'
            },
            {
                id: 44,
                value: 'campaignParameter 44'
            }
        ]

    };

    runCode(mockData);
    if (debugTest) {
        debugLog(calls);
    }
    assertApi('gtmOnSuccess').wasCalled();
    assertThat(calls.length).isEqualTo(2);

    calls.forEach((call, index) => {
        switch (index) {
            case 0:
                is(call, 'method', 'wtSmart.campaign.data.add');
                is(call, 'config.id', 'wt_mc%3Dtest.blah.foo.bar');
                is(call, 'config.oncePerSession', true);
                is(call, 'config.parameter.43', 'campaignParameter 43');
                is(call, 'config.parameter.44', 'campaignParameter 44');
                break;
            case 1:
                is(call, 'method', 'wtSmart.track');
                is(call, 'config', false);
                break;
            default:
                break;
        }
    });
- name: ecommerce only
  code: |
    const mockData = {
        requestType: 'page',
        keepData: false,
        track: 'track',
        products: [
            {
                category: {1: 'Category A'},
                cost: '11.95',
                id: 'Product A',
                quantity: '1',
                soldOut: false,
                status: 'view',
                variant: 'Variant A'
            },
            {
                category: {1: 'Category B'},
                cost: '99.99',
                id: 'Product B',
                quantity: '1',
                soldOut: false,
                status: 'list',
                variant: 'Variant B'
            },
            {
                category: {1: 'Category C'},
                cost: '22.99',
                id: 'Product C',
                quantity: '1',
                soldOut: false,
                status: 'basket',
                variant: 'Variant C'
            },
            {
                category: {1: 'Category D'},
                cost: '33.99',
                id: 'Product D',
                quantity: '1',
                soldOut: false,
                status: 'confirmation',
                variant: 'Variant D'
            }
        ],
        orderCouponValue: '2',
        orderCurrency: 'EUR',
        orderId: 'orderId',
        orderParameter: [
            {
                id: 2,
                value: 'ecommerceparameter 2'
            },
            {
                id: 3,
                value: 'ecommerceparameter 3'
            }
        ],
        orderPredefined: [
            {id: 'paymentMethod', value: 'paymentMethod value'},
            {id: 'shippingService', value: 'shippingService value'},
            {id: 'shippingSpeed', value: 'shippingSpeed value'},
            {id: 'shippingCosts', value: 'shippingCosts value'},
            {id: 'grossMargin', value: 'grossMargin value'},
            {id: 'orderStatus', value: 'orderStatus value'}
        ],
        orderValue: '9.99'
    };

    runCode(mockData);
    if (debugTest) {
        debugLog(calls);
    }
    assertApi('gtmOnSuccess').wasCalled();
    assertThat(calls.length).isEqualTo(6);

    calls.forEach((call, index) => {
        switch (index) {
            case 0:
                is(call, 'method', 'wtSmart.order.data.add');
                is(call, 'config.id', 'orderId');
                is(call, 'config.parameter.2', 'ecommerceparameter 2');
                is(call, 'config.parameter.3', 'ecommerceparameter 3');
                is(call, 'config.value', '9.99');
                is(call, 'config.currency', 'EUR');
                is(call, 'config.paymentMethod', 'paymentMethod value');
                is(call, 'config.shippingService', 'shippingService value');
                is(call, 'config.shippingSpeed', 'shippingSpeed value');
                is(call, 'config.shippingCosts', 'shippingCosts value');
                is(call, 'config.grossMargin', 'grossMargin value');
                is(call, 'config.orderStatus', 'orderStatus value');
                break;
            case 1:
                is(call, 'method', 'wtSmart.product.view.data.add');
                is(call, 'config.0.category.1', 'Category A');
                is(call, 'config.0.cost', '11.95');
                is(call, 'config.0.id', 'Product A');
                is(call, 'config.0.quantity', '1');
                is(call, 'config.0.soldOut', false);
                is(call, 'config.0.status', 'view');
                is(call, 'config.0.variant', 'Variant A');
                break;
            case 2:
                is(call, 'method', 'wtSmart.product.list.data.add');
                is(call, 'config.0.category.1', 'Category B');
                is(call, 'config.0.cost', '99.99');
                is(call, 'config.0.id', 'Product B');
                is(call, 'config.0.quantity', '1');
                is(call, 'config.0.soldOut', false);
                is(call, 'config.0.status', 'list');
                is(call, 'config.0.variant', 'Variant B');
                break;
            case 3:
                is(call, 'method', 'wtSmart.product.basket.data.add');
                is(call, 'config.0.category.1', 'Category C');
                is(call, 'config.0.cost', '22.99');
                is(call, 'config.0.id', 'Product C');
                is(call, 'config.0.quantity', '1');
                is(call, 'config.0.soldOut', false);
                is(call, 'config.0.status', 'basket');
                is(call, 'config.0.variant', 'Variant C');
                break;
            case 4:
                is(call, 'method', 'wtSmart.product.confirmation.data.add');
                is(call, 'config.0.category.1', 'Category D');
                is(call, 'config.0.cost', '33.99');
                is(call, 'config.0.id', 'Product D');
                is(call, 'config.0.quantity', '1');
                is(call, 'config.0.soldOut', false);
                is(call, 'config.0.status', 'confirmation');
                is(call, 'config.0.variant', 'Variant D');
                break;
            case 5:
                is(call, 'method', 'wtSmart.track');
                is(call, 'config', false);
                break;
            default:
                break;
        }
    });
- name: action only
  code: |
    const mockData = {
        requestType: 'event',
        keepData: false,
        track: 'track',
        actionName: 'eventValue',
        actionParameter: [
            {
                id: 2,
                value: 'actionparameter 2'
            },
            {
                id: 3,
                value: 'actionparameter 3'
            }
        ],
        actionGoal: [
            {
                id: 2,
                value: 'actionGoal 2'
            },
            {
                id: 3,
                value: 'actionGoal 3'
            }
        ]
    };

    runCode(mockData);
    if (debugTest) {
        debugLog(calls);
    }
    assertApi('gtmOnSuccess').wasCalled();
    assertThat(calls.length).isEqualTo(2);

    calls.forEach((call, index) => {
        switch (index) {
            case 0:
                is(call, 'method', 'wtSmart.action.data.add');
                is(call, 'config.name', 'eventValue');
                is(call, 'config.parameter.2', 'actionparameter 2');
                is(call, 'config.parameter.3', 'actionparameter 3');
                is(call, 'config.goal.2', 'actionGoal 2');
                is(call, 'config.goal.3', 'actionGoal 3');
                break;
            case 1:
                is(call, 'method', 'wtSmart.track');
                is(call, 'config', false);
                break;
            default:
                break;
        }
    });
- name: linktracking only
  code: |
    const mockData = {
        requestType: 'page',
        keepData: false,
        track: 'track',
        extensionActionActivate: true,
        extensionActionType: 'standard',
        extensionActionAttribute: 'webtrekk-data',
        extensionActionParameter: [
            {
                id: 2,
                value: 'ck2'
            },
            {
                id: 3,
                value: 'ck3'
            }
        ],
        extensionActionWithHash: false,
        extensionActionExtend: 'para1,para2',
        extensionActionDelay: true,
        extensionActionDelayDuration: '300',
        extensionActionNoDelayAttribute: 'nodelay'
    };

    runCode(mockData);
    if (debugTest) {
        debugLog(calls);
    }
    assertApi('gtmOnSuccess').wasCalled();
    assertThat(calls.length).isEqualTo(3);

    calls.forEach((call, index) => {
        switch (index) {
            case 0:
                is(call, 'method', 'wtSmart.extension.action.config');
                is(call, 'config.type', 'standard');
                is(call, 'config.attribute', 'webtrekk-data');
                is(call, 'config.parameter.2', 'ck2');
                is(call, 'config.parameter.3', 'ck3');
                is(call, 'config.withHash', false);
                is(call, 'config.delay', true);
                is(call, 'config.noDelayAttribute', 'nodelay');
                is(call, 'config.extend', ['para1', 'para2']);
                is(call, 'config.delayDuration', '300');
                break;
            case 1:
                is(call, 'method', 'wtSmart.extension.action.activate');
                break;
            case 2:
                is(call, 'method', 'wtSmart.track');
                is(call, 'config', false);
                break;
            default:
                break;
        }
    });
- name: formtracking only
  code: |
    const mockData = {
        requestType: 'page',
        keepData: false,
        track: 'track',
        extensionFormActivate: true,
        extensionFormAutomatic: true,
        extensionFormSelector: 'myform',
        extensionFormAttribute: 'foo',
        extensionFormFullContent: 'name,address',
        extensionFormAnonymous: false,
        extensionFormPathAnalysis: true,
        extensionFormFieldAttribute: 'data-name',
        extensionFormFieldValue: 'value',
        extensionFormFieldDefaults: [
            {
                id: 'defaultFoo',
                value: 'defaultBar'
            }
        ]
    };

    runCode(mockData);
    if (debugTest) {
        debugLog(calls);
    }
    assertApi('gtmOnSuccess').wasCalled();
    assertThat(calls.length).isEqualTo(2);

    calls.forEach((call, index) => {
        switch (index) {
            case 0:
                is(call, 'method', 'wtSmart.extension.form.config');
                is(call, 'config.automatic', 'myform');
                is(call, 'config.attribute', 'foo');
                is(call, 'config.fullContent', ['name', 'address']);
                is(call, 'config.anonymous', false);
                is(call, 'config.pathAnalysis', true);
                is(call, 'config.field.attribute', 'data-name');
                is(call, 'config.field.value', 'value');
                is(call, 'config.field.defaults', {defaultFoo: 'defaultBar'});
                break;
            case 2:
                is(call, 'method', 'wtSmart.track');
                is(call, 'config', false);
                break;
            default:
                break;
        }
    });
- name: reload form and linktracking
  code: |
    const mockData = {
        requestType: 'event',
        keepData: false,
        track: 'track',
        extensionFormUpdate: true,
        extensionActionReload: true
    };

    runCode(mockData);
    if (debugTest) {
        debugLog(calls);
    }
    assertApi('gtmOnSuccess').wasCalled();
    assertThat(calls.length).isEqualTo(3);

    calls.forEach((call, index) => {
        switch (index) {
            case 0:
                is(call, 'method', 'wtSmart.extension.action.reload');
                break;
            case 1:
                is(call, 'method', 'wtSmart.extension.form.update');
                break;
            case 2:
                is(call, 'method', 'wtSmart.track');
                is(call, 'config', false);
                break;
            default:
                break;
        }
    });
- name: giant pagerequest
  code: |
    const mockData = {
        requestType: 'page',
        keepData: false,
        track: 'track',
        initTrackDomain: 'track.webtrekk.com',
        initTrackId: '111111111111111',
        initDomain: 'test.de,bla.com',
        cookie: '1',
        advancedExecCDB: true,
        advancedForceOldEverId: true,
        advancedOptOutName: 'customCookieName',
        advancedRequestObfuscation: false,
        advancedSecureCookie: true,
        advancedSendViaSDK: false,
        advancedUseCDBCache: false,
        advancedUseHashForDefaultPageName: true,
        requestQueueActivated: true,
        requestQueueResendInterval: '7',
        requestQueueSize: '99',
        requestQueueTtl: '299',
        useParamsForDefaultPageName: 'para1,para2',
        pageName: 'pagename',
        pageCategory: [
            {
                id: 43,
                value: 'pagecategory 43'
            }
        ],
        pageGoal: [
            {
                id: 11,
                value: 'pagegoal 11'
            }
        ],
        pageParameter: [
            {
                id: 2,
                value: 'pageparameter 2'
            },
            {
                id: 3,
                value: 'pageparameter 3'
            }
        ],
        pageNumberSearchResults: '23',
        pageSearch: 'search term',
        pagePredefined: [
            {id: 'errorMessages', value: 'errorMessages value'},
            {id: 'paywall', value: 'paywall value'},
            {id: 'articleTitle', value: 'articleTitle value'},
            {id: 'contentTags', value: 'contentTags value'},
            {id: 'title', value: 'title value'},
            {id: 'type', value: 'type value'},
            {id: 'length', value: 'length value'},
            {id: 'daysSincePublication', value: 'daysSincePublication value'},
            {id: 'testVariant', value: 'testVariant value'},
            {id: 'testExperiment', value: 'testExperiment value'}
        ],
        campaignId: 'wt_mc%3Dtest.blah.foo.bar',
        campaignOncePerSession: true,
        campaignParameter: [
            {
                id: 43,
                value: 'campaignParameter 43'
            },
            {
                id: 44,
                value: 'campaignParameter 44'
            }
        ],
        customerId: 'abc@def.de',
        overwriteCustomerValidation: true,
        customerCategory: [
            {
                id: 43,
                value: 'customercategory 43'
            },
            {
                id: 44,
                value: 'customercategory 44'
            }
        ],
        customerPredefined: [
            {id: 'email', value: 'email value'},
            {id: 'emailRID', value: 'emailRID value'},
            {id: 'firstName', value: 'firstName value'},
            {id: 'lastName', value: 'lastName value'},
            {id: 'telephone', value: 'telephone value'},
            {id: 'gender', value: 'gender value'},
            {id: 'birthday', value: 'birthday value'},
            {id: 'country', value: 'country value'},
            {id: 'city', value: 'city value'},
            {id: 'street', value: 'street value'},
            {id: 'streetNumber', value: 'streetNumber value'}
        ],
        products: [
            {
                category: {1: 'Category A'},
                cost: '11.95',
                id: 'Product A',
                quantity: '1',
                soldOut: false,
                status: 'view',
                variant: 'Variant A'
            },
            {
                category: {1: 'Category B'},
                cost: '99.99',
                id: 'Product B',
                quantity: '1',
                soldOut: false,
                status: 'list',
                variant: 'Variant B'
            },
            {
                category: {1: 'Category C'},
                cost: '22.99',
                id: 'Product C',
                quantity: '1',
                soldOut: false,
                status: 'basket',
                variant: 'Variant C'
            },
            {
                category: {1: 'Category D'},
                cost: '33.99',
                id: 'Product D',
                quantity: '1',
                soldOut: false,
                status: 'confirmation',
                variant: 'Variant D'
            }
        ],
        orderCouponValue: '2',
        orderCurrency: 'EUR',
        orderId: 'orderId',
        orderParameter: [
            {
                id: 2,
                value: 'ecommerceparameter 2'
            },
            {
                id: 3,
                value: 'ecommerceparameter 3'
            }
        ],
        orderPredefined: [
            {id: 'paymentMethod', value: 'paymentMethod value'},
            {id: 'shippingService', value: 'shippingService value'},
            {id: 'shippingSpeed', value: 'shippingSpeed value'},
            {id: 'shippingCosts', value: 'shippingCosts value'},
            {id: 'grossMargin', value: 'grossMargin value'},
            {id: 'orderStatus', value: 'orderStatus value'}
        ],
        orderValue: '9.99',
        sessionLoginStatus: 'logged in',
        sessionParameter: [
            {
                id: 2,
                value: 'sessionparameter 2'
            },
            {
                id: 3,
                value: 'sessionparameter 3'
            }
        ],
        extensionActionActivate: true,
        extensionActionType: 'standard',
        extensionActionAttribute: 'webtrekk-data',
        extensionActionParameter: [
            {
                id: 2,
                value: 'ck2'
            },
            {
                id: 3,
                value: 'ck3'
            }
        ],
        extensionActionWithHash: false,
        extensionActionExtend: 'para1,para2',
        extensionActionDelay: true,
        extensionActionDelayDuration: '300',
        extensionActionNoDelayAttribute: 'nodelay',
        extensionFormActivate: true,
        extensionFormAutomatic: true,
        extensionFormSelector: 'myform',
        extensionFormAttribute: 'foo',
        extensionFormFullContent: 'name,address',
        extensionFormAnonymous: false,
        extensionFormPathAnalysis: true,
        extensionFormFieldAttribute: 'data-name',
        extensionFormFieldValue: 'value',
        extensionFormFieldDefaults: [
            {
                id: 'defaultFoo',
                value: 'defaultBar'
            }
        ]
    };

    runCode(mockData);
    if (debugTest) {
        debugLog(calls);
    }
    assertApi('gtmOnSuccess').wasCalled();
    assertThat(calls.length).isEqualTo(15);

    calls.forEach((call, index) => {
        switch (index) {
            case 0:
                is(call, 'method', 'wtSmart.init.add');
                is(call, 'config.trackDomain', 'track.webtrekk.com');
                is(call, 'config.cookie', '1');
                is(call, 'config.domain', ['test.de', 'bla.com']);
                break;
            case 1:
                is(call, 'method', 'wtSmart.advanced.add');
                is(call, 'config.execCDB', true);
                is(call, 'config.forceOldEverId', true);
                is(call, 'config.optOutName', 'customCookieName');
                is(call, 'config.requestObfuscation', false);
                is(call, 'config.secureCookie', true);
                is(call, 'config.sendViaSDK', false);
                is(call, 'config.useCDBCache', false);
                is(call, 'config.useHashForDefaultPageName', true);
                is(call, 'config.requestQueue.activated', true);
                is(call, 'config.requestQueue.resendInterval', 7000);
                is(call, 'config.requestQueue.size', '99');
                is(call, 'config.requestQueue.ttl', 299000);
                is(call, 'config.useParamsForDefaultPageName', ['para1', 'para2']);
                break;
            case 2:
                is(call, 'method', 'wtSmart.page.data.add');
                is(call, 'config.name', 'pagename');
                is(call, 'config.category.43', 'pagecategory 43');
                is(call, 'config.goal.11', 'pagegoal 11');
                is(call, 'config.parameter.2', 'pageparameter 2');
                is(call, 'config.parameter.3', 'pageparameter 3');
                is(call, 'config.numberSearchResults', '23');
                is(call, 'config.search', 'search term');
                is(call, 'config.errorMessages', 'errorMessages value');
                is(call, 'config.paywall', 'paywall value');
                is(call, 'config.articleTitle', 'articleTitle value');
                is(call, 'config.contentTags', 'contentTags value');
                is(call, 'config.title', 'title value');
                is(call, 'config.type', 'type value');
                is(call, 'config.length', 'length value');
                is(call, 'config.daysSincePublication', 'daysSincePublication value');
                is(call, 'config.testVariant', 'testVariant value');
                is(call, 'config.testExperiment', 'testExperiment value');
                break;
            case 3:
                is(call, 'method', 'wtSmart.order.data.add');
                is(call, 'config.id', 'orderId');
                is(call, 'config.parameter.2', 'ecommerceparameter 2');
                is(call, 'config.parameter.3', 'ecommerceparameter 3');
                is(call, 'config.value', '9.99');
                is(call, 'config.currency', 'EUR');
                is(call, 'config.paymentMethod', 'paymentMethod value');
                is(call, 'config.shippingService', 'shippingService value');
                is(call, 'config.shippingSpeed', 'shippingSpeed value');
                is(call, 'config.shippingCosts', 'shippingCosts value');
                is(call, 'config.grossMargin', 'grossMargin value');
                is(call, 'config.orderStatus', 'orderStatus value');
                break;
            case 4:
                is(call, 'method', 'wtSmart.product.view.data.add');
                is(call, 'config.0.category.1', 'Category A');
                is(call, 'config.0.cost', '11.95');
                is(call, 'config.0.id', 'Product A');
                is(call, 'config.0.quantity', '1');
                is(call, 'config.0.soldOut', false);
                is(call, 'config.0.status', 'view');
                is(call, 'config.0.variant', 'Variant A');
                break;
            case 5:
                is(call, 'method', 'wtSmart.product.list.data.add');
                is(call, 'config.0.category.1', 'Category B');
                is(call, 'config.0.cost', '99.99');
                is(call, 'config.0.id', 'Product B');
                is(call, 'config.0.quantity', '1');
                is(call, 'config.0.soldOut', false);
                is(call, 'config.0.status', 'list');
                is(call, 'config.0.variant', 'Variant B');
                break;
            case 6:
                is(call, 'method', 'wtSmart.product.basket.data.add');
                is(call, 'config.0.category.1', 'Category C');
                is(call, 'config.0.cost', '22.99');
                is(call, 'config.0.id', 'Product C');
                is(call, 'config.0.quantity', '1');
                is(call, 'config.0.soldOut', false);
                is(call, 'config.0.status', 'basket');
                is(call, 'config.0.variant', 'Variant C');
                break;
            case 7:
                is(call, 'method', 'wtSmart.product.confirmation.data.add');
                is(call, 'config.0.category.1', 'Category D');
                is(call, 'config.0.cost', '33.99');
                is(call, 'config.0.id', 'Product D');
                is(call, 'config.0.quantity', '1');
                is(call, 'config.0.soldOut', false);
                is(call, 'config.0.status', 'confirmation');
                is(call, 'config.0.variant', 'Variant D');
                break;
            case 8:
                is(call, 'method', 'wtSmart.campaign.data.add');
                is(call, 'config.id', 'wt_mc%3Dtest.blah.foo.bar');
                is(call, 'config.oncePerSession', true);
                is(call, 'config.parameter.43', 'campaignParameter 43');
                is(call, 'config.parameter.44', 'campaignParameter 44');
                break;
            case 9:
                is(call, 'method', 'wtSmart.session.data.add');
                is(call, 'config.loginStatus', 'logged in');
                is(call, 'config.parameter.2', 'sessionparameter 2');
                is(call, 'config.parameter.3', 'sessionparameter 3');
                break;
            case 10:
                is(call, 'method', 'wtSmart.customer.data.add');
                is(call, 'config.id', 'abc@def.de');
                is(call, 'config.validation', true);
                is(call, 'config.category.43', 'customercategory 43');
                is(call, 'config.category.44', 'customercategory 44');
                is(call, 'config.validation', true);
                is(call, 'config.email', 'email value');
                is(call, 'config.emailRID', 'emailRID value');
                is(call, 'config.firstName', 'firstName value');
                is(call, 'config.lastName', 'lastName value');
                is(call, 'config.telephone', 'telephone value');
                is(call, 'config.gender', 'gender value');
                is(call, 'config.birthday', 'birthday value');
                is(call, 'config.country', 'country value');
                is(call, 'config.city', 'city value');
                is(call, 'config.street', 'street value');
                is(call, 'config.streetNumber', 'streetNumber value');
                break;
            case 11:
                is(call, 'method', 'wtSmart.extension.action.config');
                is(call, 'config.type', 'standard');
                is(call, 'config.attribute', 'webtrekk-data');
                is(call, 'config.parameter.2', 'ck2');
                is(call, 'config.parameter.3', 'ck3');
                is(call, 'config.withHash', false);
                is(call, 'config.delay', true);
                is(call, 'config.noDelayAttribute', 'nodelay');
                is(call, 'config.extend', ['para1', 'para2']);
                is(call, 'config.delayDuration', '300');
                break;
            case 12:
                is(call, 'method', 'wtSmart.extension.action.activate');
                break;
            case 13:
                is(call, 'method', 'wtSmart.extension.form.config');
                is(call, 'config.automatic', 'myform');
                is(call, 'config.attribute', 'foo');
                is(call, 'config.fullContent', ['name', 'address']);
                is(call, 'config.anonymous', false);
                is(call, 'config.pathAnalysis', true);
                is(call, 'config.field.attribute', 'data-name');
                is(call, 'config.field.value', 'value');
                is(call, 'config.field.defaults', {defaultFoo: 'defaultBar'});
                break;
            case 14:
                is(call, 'method', 'wtSmart.track');
                is(call, 'config', false);
                break;
            default:
                break;
        }
    });
- name: giant actionrequest
  code: |
    const mockData = {
        requestType: 'event',
        keepData: false,
        track: 'track',
        actionName: 'eventValue',
        actionParameter: [
            {
                id: 2,
                value: 'actionparameter 2'
            },
            {
                id: 3,
                value: 'actionparameter 3'
            }
        ],
        actionGoal: [
            {
                id: 2,
                value: 'actionGoal 2'
            },
            {
                id: 3,
                value: 'actionGoal 3'
            }
        ],
        extensionFormUpdate: true,
        extensionActionReload: true,
        campaignId: 'wt_mc%3Dtest.blah.foo.bar',
        campaignOncePerSession: true,
        campaignParameter: [
            {
                id: 43,
                value: 'campaignParameter 43'
            },
            {
                id: 44,
                value: 'campaignParameter 44'
            }
        ],
        sessionLoginStatus: 'logged in',
        sessionParameter: [
            {
                id: 2,
                value: 'sessionparameter 2'
            },
            {
                id: 3,
                value: 'sessionparameter 3'
            }
        ],
        customerId: 'abc@def.de',
        overwriteCustomerValidation: true,
        customerCategory: [
            {
                id: 43,
                value: 'customercategory 43'
            },
            {
                id: 44,
                value: 'customercategory 44'
            }
        ],
        customerPredefined: [
            {id: 'email', value: 'email value'},
            {id: 'emailRID', value: 'emailRID value'},
            {id: 'firstName', value: 'firstName value'},
            {id: 'lastName', value: 'lastName value'},
            {id: 'telephone', value: 'telephone value'},
            {id: 'gender', value: 'gender value'},
            {id: 'birthday', value: 'birthday value'},
            {id: 'country', value: 'country value'},
            {id: 'city', value: 'city value'},
            {id: 'street', value: 'street value'},
            {id: 'streetNumber', value: 'streetNumber value'}
        ]
    };

    runCode(mockData);
    if (debugTest) {
        debugLog(calls);
    }
    assertApi('gtmOnSuccess').wasCalled();
    assertThat(calls.length).isEqualTo(7);

    calls.forEach((call, index) => {
        switch (index) {
            case 0:
                is(call, 'method', 'wtSmart.action.data.add');
                is(call, 'config.name', 'eventValue');
                is(call, 'config.parameter.2', 'actionparameter 2');
                is(call, 'config.parameter.3', 'actionparameter 3');
                is(call, 'config.goal.2', 'actionGoal 2');
                is(call, 'config.goal.3', 'actionGoal 3');
                break;
            case 1:
                is(call, 'method', 'wtSmart.extension.action.reload');
                break;
            case 2:
                is(call, 'method', 'wtSmart.extension.form.update');
                break;
            case 3:
                is(call, 'method', 'wtSmart.campaign.data.add');
                is(call, 'config.id', 'wt_mc%3Dtest.blah.foo.bar');
                is(call, 'config.oncePerSession', true);
                is(call, 'config.parameter.43', 'campaignParameter 43');
                is(call, 'config.parameter.44', 'campaignParameter 44');
                break;
            case 4:
                is(call, 'method', 'wtSmart.session.data.add');
                is(call, 'config.loginStatus', 'logged in');
                is(call, 'config.parameter.2', 'sessionparameter 2');
                is(call, 'config.parameter.3', 'sessionparameter 3');
                break;
            case 5:
                is(call, 'method', 'wtSmart.customer.data.add');
                is(call, 'config.id', 'abc@def.de');
                is(call, 'config.validation', true);
                is(call, 'config.category.43', 'customercategory 43');
                is(call, 'config.category.44', 'customercategory 44');
                is(call, 'config.validation', true);
                is(call, 'config.email', 'email value');
                is(call, 'config.emailRID', 'emailRID value');
                is(call, 'config.firstName', 'firstName value');
                is(call, 'config.lastName', 'lastName value');
                is(call, 'config.telephone', 'telephone value');
                is(call, 'config.gender', 'gender value');
                is(call, 'config.birthday', 'birthday value');
                is(call, 'config.country', 'country value');
                is(call, 'config.city', 'city value');
                is(call, 'config.street', 'street value');
                is(call, 'config.streetNumber', 'streetNumber value');
                break;
            case 6:
                is(call, 'method', 'wtSmart.track');
                is(call, 'config', false);
                break;
            default:
                break;
        }
    });
- name: track methods
  code: |
    const mockData = {};

    mockData.keepData = false;
    mockData.track = 'track';
    runCode(mockData);

    mockData.keepData = true;
    mockData.track = 'track';
    runCode(mockData);

    mockData.keepData = false;
    mockData.track = 'trackPage';
    runCode(mockData);

    mockData.keepData = true;
    mockData.track = 'trackPage';
    runCode(mockData);

    mockData.keepData = false;
    mockData.track = 'trackAction';
    runCode(mockData);

    mockData.keepData = true;
    mockData.track = 'trackAction';
    runCode(mockData);

    mockData.track = false;
    runCode(mockData);

    if (debugTest) {
        debugLog(calls);
    }

    assertApi('gtmOnSuccess').wasCalled();
    assertThat(calls.length).isEqualTo(6);

    calls.forEach((call, index) => {
        switch (index) {
            case 0:
                is(call, 'method', 'wtSmart.track');
                is(call, 'config', false);
                break;
            case 1:
                is(call, 'method', 'wtSmart.track');
                is(call, 'config', true);
                break;
            case 2:
                is(call, 'method', 'wtSmart.trackPage');
                is(call, 'config', false);
                break;
            case 3:
                is(call, 'method', 'wtSmart.trackPage');
                is(call, 'config', true);
                break;
            case 4:
                is(call, 'method', 'wtSmart.trackAction');
                is(call, 'config', false);
                break;
            case 5:
                is(call, 'method', 'wtSmart.trackAction');
                is(call, 'config', true);
                break;
            default:
                break;
        }
    });
setup: |-
  /* eslint-disable no-unused-vars */
  const log = require('logToConsole');
  let debugTest = false; // true will log all Pixel calls to the console during the test
  const calls = [];
  mock('callInWindow', (method, config) => {
      calls.push({method: method, config: config});
  });

  /**
   * @param {Object} obj
   * @param {string} key
   * @returns {*}
   */
  const reducer = (obj, key) => obj[key];

  /**
   * Function to run tests
   * @param {Object} call Current pixel call
   * @param {string} path Path in call object
   * @param {*} assumption
   */
  const is = (call, path, assumption) => {
      assertThat(path.split('.').reduce(reducer, call), 'No match in: ' + path).isEqualTo(assumption);
  };

  /**
   * Log pixel calls
   * @param {Array} callsArray
   */
  const debugLog = (callsArray) => {
      log('--- DEBUG PIXEL CALLS ---');
      callsArray.forEach((call) => {
          log(call);
      });
      log('--- END DEBUG ---');
  };


___NOTES___

Created on 12/12/2019, 3:24:10 PM


